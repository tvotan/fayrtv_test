{"ast":null,"code":"import _regeneratorRuntime from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{EVENT}from'./events';import{NekoClient}from'.';// import { EVENT } from './events';\nvar VBrowser=/*#__PURE__*/function(_React$Component){_inherits(VBrowser,_React$Component);var _super=_createSuper(VBrowser);function VBrowser(){var _this;_classCallCheck(this,VBrowser);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.focused=false;_this.fullscreen=false;_this.activeKeys=new Set();_this.controlling=false;_this.scroll=1;_this.scroll_invert=true;_this.width=1280;_this.height=720;_this.rate=30;_this.keepAliveInterval=0;_this._container=React.createRef();_this._overlay=React.createRef();_this._video=React.createRef();_this.$client=new NekoClient();_this.takeControl=function(){if(_this.$client.connected){_this.$client.sendMessage(EVENT.ADMIN.CONTROL);}else{_this.$client.once(EVENT.CONNECTED,function(){_this.$client.sendMessage(EVENT.ADMIN.CONTROL);});}};_this.changeResolution=function(resString){var split=resString.split(/x|@/);var width=Number(split[0]);var height=Number(split[1]);var rate=Number(split[2]);_this.$client.sendMessage(EVENT.SCREEN.SET,{width:width,height:height,rate:rate});};_this.onFocus=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var text;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(_this.props.controlling&&navigator.clipboard&&typeof navigator.clipboard.readText==='function')){_context.next=5;break;}_context.next=3;return navigator.clipboard.readText();case 3:text=_context.sent;// console.log('[FOCUS]', text);\n// send clipboard contents to vbrowser\n_this.$client.sendMessage(EVENT.CONTROL.CLIPBOARD,{text:text});case 5:case\"end\":return _context.stop();}}},_callee);}));_this.onBlur=function(){if(!_this.focused||!_this.controlling){return;}_this.activeKeys.forEach(function(key){_this.$client.sendData('keyup',{key:key});_this.activeKeys.delete(key);});};_this.onClick=function(e){e.stopPropagation();e.preventDefault();};_this.onContextMenu=function(e){e.stopPropagation();e.preventDefault();};_this.onMousePos=function(e){var _w$h={w:_this.width,h:_this.height},w=_w$h.w,h=_w$h.h;var rect=_this._overlay.current.getBoundingClientRect();_this.$client.sendData('mousemove',{x:Math.round(w/rect.width*(e.clientX-rect.left)),y:Math.round(h/rect.height*(e.clientY-rect.top))});};_this.onWheel=function(e){e.stopPropagation();e.preventDefault();if(!_this.controlling){return;}_this.onMousePos(e);var x=e.deltaX;var y=e.deltaY;if(_this.scroll_invert){x=x*-1;y=y*-1;}x=Math.min(Math.max(x,-_this.scroll),_this.scroll);y=Math.min(Math.max(y,-_this.scroll),_this.scroll);_this.$client.sendData('wheel',{x:x,y:y});};_this.onMouseDown=function(e){e.stopPropagation();e.preventDefault();if(!_this.controlling){return;}_this.onMousePos(e);_this.$client.sendData('mousedown',{key:e.button});};_this.onMouseUp=function(e){e.stopPropagation();e.preventDefault();if(!_this.controlling){return;}_this.onMousePos(e);_this.$client.sendData('mouseup',{key:e.button});};_this.onMouseMove=function(e){if(!_this.controlling){return;}_this.onMousePos(e);};_this.onMouseEnter=function(e){if(!_this.controlling){return;}_this._overlay.current.focus();_this.onFocus();_this.focused=true;};_this.onMouseLeave=function(e){if(!_this.controlling){return;}_this._overlay.current.blur();_this.focused=false;};_this.getCode=function(e){var key=e.keyCode;if(key===59&&(e.key===';'||e.key===':')){key=186;}if(key===61&&(e.key==='='||e.key==='+')){key=187;}if(key===173&&(e.key==='-'||e.key==='_')){key=189;}return key;};_this.onKeyDown=function(e){e.stopPropagation();e.preventDefault();if(!_this.focused||!_this.controlling){return;}var key=_this.getCode(e);_this.$client.sendData('keydown',{key:key});_this.activeKeys.add(key);};_this.onKeyUp=function(e){e.stopPropagation();e.preventDefault();if(!_this.focused||!_this.controlling){return;}var key=_this.getCode(e);_this.$client.sendData('keyup',{key:key});_this.activeKeys.delete(key);};_this.onResize=function(){// let height = 0;\n// if (!this.fullscreen) {\n//   const offsetWidth = this._component.current?.offsetWidth;\n//   const offsetHeight = this._component.current?.offsetHeight;\n//   this._player.current!.style.width = `${offsetWidth}px`;\n//   this._player.current!.style.height = `${offsetHeight}px`;\n//   height = offsetHeight as number;\n// } else {\n//   const offsetHeight = this._player.current?.offsetHeight;\n//   height = offsetHeight as number;\n// }\n// this._container.current!.style.maxWidth = `${\n//   (this.horizontal / this.vertical) * height\n// }px`;\n// this._aspect.current!.style.paddingBottom = `${\n//   (this.vertical / this.horizontal) * 100\n// }%`;\n};return _this;}_createClass(VBrowser,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this,_document$getElementB;this.controlling=this.props.controlling;this.keepAliveInterval=window.setInterval(function(){return _this2.$client.sendMessage('ka');},10000);this.$client.on(EVENT.CONNECTED,function(){if(_this2.props.controlling){_this2.takeControl();}});this.$client.on(EVENT.DISCONNECTED,function(){_this2.$client.login(url,_this2.props.password,_this2.props.username);});this.$client.on(EVENT.SCREEN.RESOLUTION,function(data){_this2.width=data.width;_this2.height=data.height;_this2.rate=data.rate;// Update our state with the resolution sent from server\n_this2.props.setResolution(\"\".concat(_this2.width,\"x\").concat(_this2.height,\"@\").concat(_this2.rate));});this.$client.on(EVENT.TRACK,function(track,stream){// console.log(track, streams);\nvar video=document.getElementById('leftVideo');video.src='';video.srcObject=stream;if(!_this2.props.isAutoPlayable){video.muted=true;}video.play();});this.$client.on(EVENT.CONTROL.CLIPBOARD,this.onClipboardChanged);if(process.env.NODE_ENV==='development'){this.$client.on('debug',function(e,data){return console.log(e,data);});}var url='wss://'+this.props.hostname+'/';this.$client.login(url,this.props.password,this.props.username);// this._container.current?.addEventListener('resize', this.onResize);\n// this.onResize();\n// document.addEventListener('fullscreenchange', () => {\n//   this.onResize();\n// });\ndocument.addEventListener('focusin',this.onFocus.bind(this));document.addEventListener('focusout',this.onBlur.bind(this));(_document$getElementB=document.getElementById('leftOverlay'))===null||_document$getElementB===void 0?void 0:_document$getElementB.addEventListener('wheel',this.onWheel,{passive:false});}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){// console.log(this.props.controlling, prevProps.controlling);\nthis.controlling=this.props.controlling;if(this.props.controlling&&!prevProps.controlling){this.takeControl();}if(this.props.resolution!==prevProps.resolution){this.changeResolution(this.props.resolution);}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){window.clearInterval(this.keepAliveInterval);this.$client.removeAllListeners();this.$client.logout();}},{key:\"onClipboardChanged\",value:function onClipboardChanged(clipboard){if(navigator.clipboard&&typeof navigator.clipboard.writeText==='function'){// Received clipboard contents from vbrowser\nnavigator.clipboard.writeText(clipboard);}}},{key:\"render\",value:function render(){var _document$getElementB2,_document$getElementB3;return/*#__PURE__*/React.createElement(\"div\",{ref:this._container,style:{position:'relative',width:'100%'}},/*#__PURE__*/React.createElement(\"video\",{ref:this._video,id:\"leftVideo\",style:{width:'100%'}}),/*#__PURE__*/React.createElement(\"div\",{ref:this._overlay,id:'leftOverlay',tabIndex:0,style:{width:(_document$getElementB2=document.getElementById('leftVideo'))===null||_document$getElementB2===void 0?void 0:_document$getElementB2.clientWidth,height:(_document$getElementB3=document.getElementById('leftVideo'))===null||_document$getElementB3===void 0?void 0:_document$getElementB3.clientHeight,position:'absolute',top:0,bottom:0,// disable firefox scrollbars?\nscrollbarWidth:'none'},onClick:this.onClick,onContextMenu:this.onContextMenu// onWheel={this.onWheel}\n,onMouseMove:this.onMouseMove,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp}));}}]);return VBrowser;}(React.Component);export{VBrowser as default};","map":{"version":3,"sources":["/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/src/components/VBrowser/VBrowser.tsx"],"names":["React","EVENT","NekoClient","VBrowser","focused","fullscreen","activeKeys","Set","controlling","scroll","scroll_invert","width","height","rate","keepAliveInterval","_container","createRef","_overlay","_video","$client","takeControl","connected","sendMessage","ADMIN","CONTROL","once","CONNECTED","changeResolution","resString","split","Number","SCREEN","SET","onFocus","props","navigator","clipboard","readText","text","CLIPBOARD","onBlur","forEach","key","sendData","delete","onClick","e","stopPropagation","preventDefault","onContextMenu","onMousePos","w","h","rect","current","getBoundingClientRect","x","Math","round","clientX","left","y","clientY","top","onWheel","deltaX","deltaY","min","max","onMouseDown","button","onMouseUp","onMouseMove","onMouseEnter","focus","onMouseLeave","blur","getCode","keyCode","onKeyDown","add","onKeyUp","onResize","window","setInterval","on","DISCONNECTED","login","url","password","username","RESOLUTION","data","setResolution","TRACK","track","stream","video","document","getElementById","src","srcObject","isAutoPlayable","muted","play","onClipboardChanged","process","env","NODE_ENV","console","log","hostname","addEventListener","bind","passive","prevProps","resolution","clearInterval","removeAllListeners","logout","writeText","position","clientWidth","clientHeight","bottom","scrollbarWidth","Component"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport { EVENT } from './events';\nimport { NekoClient } from '.';\n\n// import { EVENT } from './events';\n\nexport default class VBrowser extends React.Component<{\n  username: string;\n  password: string;\n  hostname: string;\n  controlling: boolean;\n  setLoadingFalse: Function;\n  resolution: string;\n  setResolution: Function;\n  isAutoPlayable: boolean;\n}> {\n  // private observer = new ResizeObserver(this.onResize);\n  private focused = false;\n  private fullscreen = false;\n  private activeKeys: Set<number> = new Set();\n  private controlling = false;\n  private scroll = 1; // 1 to 10\n  private scroll_invert = true;\n  private width = 1280;\n  private height = 720;\n  private rate = 30;\n  private keepAliveInterval = 0;\n  // private _component = React.createRef<HTMLDivElement>();\n  private _container = React.createRef<HTMLDivElement>();\n  private _overlay = React.createRef<HTMLDivElement>();\n  // private _aspect = React.createRef<HTMLDivElement>();\n  // private _player = React.createRef<HTMLDivElement>();\n  private _video = React.createRef<HTMLVideoElement>();\n  // private _resolution = React.createRef<HTMLDivElement>();\n  private $client: NekoClient = new NekoClient();\n\n  componentDidMount() {\n    this.controlling = this.props.controlling;\n    this.keepAliveInterval = window.setInterval(\n      () => this.$client.sendMessage('ka'),\n      10000\n    );\n\n    this.$client.on(EVENT.CONNECTED, () => {\n      if (this.props.controlling) {\n        this.takeControl();\n      }\n    });\n    this.$client.on(EVENT.DISCONNECTED, () => {\n      this.$client.login(url, this.props.password, this.props.username);\n    });\n    this.$client.on(EVENT.SCREEN.RESOLUTION, (data) => {\n      this.width = data.width;\n      this.height = data.height;\n      this.rate = data.rate;\n      // Update our state with the resolution sent from server\n      this.props.setResolution(`${this.width}x${this.height}@${this.rate}`);\n    });\n    this.$client.on(EVENT.TRACK, (track: MediaStreamTrack, stream) => {\n      // console.log(track, streams);\n      const video = document.getElementById('leftVideo') as HTMLVideoElement;\n      video.src = '';\n      video.srcObject = stream;\n      if (!this.props.isAutoPlayable) {\n        video.muted = true;\n      }\n      video.play();\n    });\n    this.$client.on(EVENT.CONTROL.CLIPBOARD, this.onClipboardChanged);\n\n    if (process.env.NODE_ENV === 'development') {\n      this.$client.on('debug', (e, data) => console.log(e, data));\n    }\n\n    const url = 'wss://' + this.props.hostname + '/';\n    this.$client.login(url, this.props.password, this.props.username);\n\n    // this._container.current?.addEventListener('resize', this.onResize);\n    // this.onResize();\n\n    // document.addEventListener('fullscreenchange', () => {\n    //   this.onResize();\n    // });\n\n    document.addEventListener('focusin', this.onFocus.bind(this));\n    document.addEventListener('focusout', this.onBlur.bind(this));\n\n    document\n      .getElementById('leftOverlay')\n      ?.addEventListener('wheel', this.onWheel, { passive: false });\n  }\n\n  componentDidUpdate(prevProps: any) {\n    // console.log(this.props.controlling, prevProps.controlling);\n    this.controlling = this.props.controlling;\n    if (this.props.controlling && !prevProps.controlling) {\n      this.takeControl();\n    }\n    if (this.props.resolution !== prevProps.resolution) {\n      this.changeResolution(this.props.resolution);\n    }\n  }\n\n  componentWillUnmount() {\n    window.clearInterval(this.keepAliveInterval);\n    this.$client.removeAllListeners();\n    this.$client.logout();\n  }\n\n  takeControl = () => {\n    if (this.$client.connected) {\n      this.$client.sendMessage(EVENT.ADMIN.CONTROL);\n    } else {\n      this.$client.once(EVENT.CONNECTED, () => {\n        this.$client.sendMessage(EVENT.ADMIN.CONTROL);\n      });\n    }\n  };\n\n  changeResolution = (resString: string) => {\n    const split = resString.split(/x|@/);\n    const width = Number(split[0]);\n    const height = Number(split[1]);\n    const rate = Number(split[2]);\n    this.$client.sendMessage(EVENT.SCREEN.SET, { width, height, rate });\n  };\n\n  onClipboardChanged(clipboard: string) {\n    if (\n      navigator.clipboard &&\n      typeof navigator.clipboard.writeText === 'function'\n    ) {\n      // Received clipboard contents from vbrowser\n      navigator.clipboard.writeText(clipboard);\n    }\n  }\n  onFocus = async () => {\n    if (\n      this.props.controlling &&\n      navigator.clipboard &&\n      typeof navigator.clipboard.readText === 'function'\n    ) {\n      const text = await navigator.clipboard.readText();\n      // console.log('[FOCUS]', text);\n      // send clipboard contents to vbrowser\n      this.$client.sendMessage(EVENT.CONTROL.CLIPBOARD, { text });\n    }\n  };\n\n  onBlur = () => {\n    if (!this.focused || !this.controlling) {\n      return;\n    }\n\n    this.activeKeys.forEach((key) => {\n      this.$client.sendData('keyup', { key });\n      this.activeKeys.delete(key);\n    });\n  };\n\n  onClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n  };\n\n  onContextMenu = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n  };\n\n  onMousePos = (e: MouseEvent | React.MouseEvent) => {\n    const { w, h } = { w: this.width, h: this.height };\n    const rect = this._overlay.current!.getBoundingClientRect();\n    this.$client.sendData('mousemove', {\n      x: Math.round((w / rect.width) * (e.clientX - rect.left)),\n      y: Math.round((h / rect.height) * (e.clientY - rect.top)),\n    });\n  };\n\n  onWheel = (e: WheelEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    if (!this.controlling) {\n      return;\n    }\n    this.onMousePos(e);\n\n    let x = e.deltaX;\n    let y = e.deltaY;\n\n    if (this.scroll_invert) {\n      x = x * -1;\n      y = y * -1;\n    }\n\n    x = Math.min(Math.max(x, -this.scroll), this.scroll);\n    y = Math.min(Math.max(y, -this.scroll), this.scroll);\n\n    this.$client.sendData('wheel', { x, y });\n  };\n\n  onMouseDown = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    if (!this.controlling) {\n      return;\n    }\n    this.onMousePos(e);\n    this.$client.sendData('mousedown', { key: e.button });\n  };\n\n  onMouseUp = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    if (!this.controlling) {\n      return;\n    }\n    this.onMousePos(e);\n    this.$client.sendData('mouseup', { key: e.button });\n  };\n\n  onMouseMove = (e: React.MouseEvent) => {\n    if (!this.controlling) {\n      return;\n    }\n    this.onMousePos(e);\n  };\n\n  onMouseEnter = (e: React.MouseEvent) => {\n    if (!this.controlling) {\n      return;\n    }\n    this._overlay.current!.focus();\n    this.onFocus();\n    this.focused = true;\n  };\n\n  onMouseLeave = (e: React.MouseEvent) => {\n    if (!this.controlling) {\n      return;\n    }\n    this._overlay.current!.blur();\n    this.focused = false;\n  };\n\n  // frick you firefox\n  getCode = (e: React.KeyboardEvent): number => {\n    let key = e.keyCode;\n    if (key === 59 && (e.key === ';' || e.key === ':')) {\n      key = 186;\n    }\n\n    if (key === 61 && (e.key === '=' || e.key === '+')) {\n      key = 187;\n    }\n\n    if (key === 173 && (e.key === '-' || e.key === '_')) {\n      key = 189;\n    }\n\n    return key;\n  };\n\n  onKeyDown = (e: React.KeyboardEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    if (!this.focused || !this.controlling) {\n      return;\n    }\n\n    let key = this.getCode(e);\n    this.$client.sendData('keydown', { key });\n    this.activeKeys.add(key);\n  };\n\n  onKeyUp = (e: React.KeyboardEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    if (!this.focused || !this.controlling) {\n      return;\n    }\n\n    let key = this.getCode(e);\n    this.$client.sendData('keyup', { key });\n    this.activeKeys.delete(key);\n  };\n\n  onResize = () => {\n    // let height = 0;\n    // if (!this.fullscreen) {\n    //   const offsetWidth = this._component.current?.offsetWidth;\n    //   const offsetHeight = this._component.current?.offsetHeight;\n    //   this._player.current!.style.width = `${offsetWidth}px`;\n    //   this._player.current!.style.height = `${offsetHeight}px`;\n    //   height = offsetHeight as number;\n    // } else {\n    //   const offsetHeight = this._player.current?.offsetHeight;\n    //   height = offsetHeight as number;\n    // }\n    // this._container.current!.style.maxWidth = `${\n    //   (this.horizontal / this.vertical) * height\n    // }px`;\n    // this._aspect.current!.style.paddingBottom = `${\n    //   (this.vertical / this.horizontal) * 100\n    // }%`;\n  };\n\n  render() {\n    return (\n      <div\n        ref={this._container}\n        style={{ position: 'relative', width: '100%' }}\n      >\n        <video ref={this._video} id=\"leftVideo\" style={{ width: '100%' }} />\n        <div\n          ref={this._overlay}\n          id={'leftOverlay'}\n          tabIndex={0}\n          style={{\n            width: document.getElementById('leftVideo')?.clientWidth,\n            height: document.getElementById('leftVideo')?.clientHeight,\n            position: 'absolute',\n            top: 0,\n            bottom: 0,\n            // disable firefox scrollbars?\n            scrollbarWidth: 'none',\n          }}\n          onClick={this.onClick}\n          onContextMenu={this.onContextMenu}\n          // onWheel={this.onWheel}\n          onMouseMove={this.onMouseMove}\n          onMouseDown={this.onMouseDown}\n          onMouseUp={this.onMouseUp}\n          onMouseEnter={this.onMouseEnter}\n          onMouseLeave={this.onMouseLeave}\n          onKeyDown={this.onKeyDown}\n          onKeyUp={this.onKeyUp}\n        />\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}