{"ast":null,"code":"import _toConsumableArray from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import'./App.css';import querystring from'querystring';import axios from'axios';//@ts-ignore\nimport magnet from'magnet-uri';import React from'react';import{Button,Dimmer,Dropdown,Grid,Icon,Input,Loader,Message,Modal,Popup,Progress,Menu}from'semantic-ui-react';//@ts-ignore\nimport io from'socket.io-client';//@ts-ignore\nimport VTTConverter from'srt-webvtt';import{formatSpeed,getMediaType,iceServers,isMobile,serverPath,testAutoplay,openFileSelector,getAndSaveClientId}from'../../utils';import{generateName}from'../../utils/generateName';import{Chat}from'../Chat';import{TopBar}from'../TopBar';import{VBrowser}from'../VBrowser';import{VideoChat}from'../VideoChat';import{getCurrentSettings}from'../Settings';import{MultiStreamModal}from'../Modal/MultiStreamModal';import{ComboBox}from'../ComboBox/ComboBox';import{SearchComponent}from'../SearchComponent/SearchComponent';import{Controls}from'../Controls/Controls';import firebase from'firebase/app';import'firebase/auth';import{SubscribeModal}from'../Modal/SubscribeModal';import{VBrowserModal}from'../Modal/VBrowserModal';import{SettingsTab}from'../Settings/SettingsTab';import{ErrorModal}from'../Modal/ErrorModal';import{PasswordModal}from'../Modal/PasswordModal';var firebaseConfig=process.env.REACT_APP_FIREBASE_CONFIG;if(firebaseConfig){firebase.initializeApp(JSON.parse(firebaseConfig));}var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={state:'starting',currentMedia:'',currentMediaPaused:false,currentSubtitle:'',participants:[],rosterUpdateTS:Number(new Date()),chat:[],tsMap:{},nameMap:{},pictureMap:{},myName:'',myPicture:'',loading:true,scrollTimestamp:0,fullScreen:false,controlsTimestamp:0,watchOptions:[],isScreenSharing:false,isScreenSharingFile:false,isVBrowser:false,user:undefined,isYouTubeReady:false,isAutoPlayable:true,downloaded:0,total:0,speed:0,connections:0,multiStreamSelection:undefined,error:'',isErrorAuth:false,settings:{},vBrowserResolution:'1280x720@30',isVBrowserLarge:false,nonPlayableMedia:false,currentTab:querystring.parse(window.location.search.substring(1)).tab||'chat',isSubscriber:false,isSubscribeModalOpen:false,isVBrowserModalOpen:false,roomLock:'',controller:'',roomId:'',savedPasswords:{},errorMessage:'',successMessage:''};_this.socket=null;_this.watchPartyYTPlayer=null;_this.ytDebounce=true;_this.screenShareStream=void 0;_this.screenHostPC={};_this.screenSharePC=void 0;_this.progressUpdater=void 0;_this.loadSettings=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var customSettingsData,customSettings,settings;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(serverPath+'/settings');case 2:customSettingsData=_context.sent;_context.next=5;return customSettingsData.json();case 5:customSettings=_context.sent;settings=_objectSpread(_objectSpread({},getCurrentSettings()),customSettings);_this.setState({settings:settings});case 8:case\"end\":return _context.stop();}}},_callee);}));_this.loadSignInData=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var user,_user$displayName,firstName,token,response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:user=_this.state.user;if(!(user&&_this.socket)){_context2.next=16;break;}// NOTE: firebase auth doesn't provide the actual first name data that individual providers (G/FB) do\n// It's accessible at the time the user logs in but not afterward\n// If we want accurate surname/given name we'll need to save that somewhere\nfirstName=(_user$displayName=user.displayName)===null||_user$displayName===void 0?void 0:_user$displayName.split(' ')[0];if(firstName){_this.updateName(null,{value:firstName});}if(user.photoURL){_this.updatePicture(user.photoURL+'?height=128&width=128');}_this.updateUid(user);_context2.next=8;return user.getIdToken();case 8:token=_context2.sent;_context2.next=11;return window.fetch(serverPath+\"/metadata?uid=\".concat(user.uid,\"&token=\").concat(token));case 11:response=_context2.sent;_context2.next=14;return response.json();case 14:data=_context2.sent;_this.setState({isSubscriber:data.isSubscriber});case 16:case\"end\":return _context2.stop();}}},_callee2);}));_this.loadYouTube=function(){// This code loads the IFrame Player API code asynchronously.\nvar tag=document.createElement('script');tag.src='https://www.youtube.com/iframe_api';var firstScriptTag=document.getElementsByTagName('script')[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);window.onYouTubeIframeAPIReady=function(){// Note: this fails silently if the element is not available\nvar ytPlayer=new window.YT.Player('leftYt',{events:{onReady:function onReady(){_this.watchPartyYTPlayer=ytPlayer;_this.setState({isYouTubeReady:true,loading:false});// We might have failed to play YT originally, ask for the current video again\nif(_this.isYouTube()){_this.socket.emit('CMD:askHost');}},onStateChange:function onStateChange(e){var _window$YT,_window$YT$PlayerStat,_window$YT2,_window$YT2$PlayerSta,_window$YT3,_window$YT3$PlayerSta;if(getMediaType(_this.state.currentMedia)==='youtube'&&e.data===((_window$YT=window.YT)===null||_window$YT===void 0?void 0:(_window$YT$PlayerStat=_window$YT.PlayerState)===null||_window$YT$PlayerStat===void 0?void 0:_window$YT$PlayerStat.CUED)){_this.setState({loading:false});}// console.log(this.ytDebounce, e.data, this.watchPartyYTPlayer?.getVideoUrl());\nif(_this.ytDebounce&&(e.data===((_window$YT2=window.YT)===null||_window$YT2===void 0?void 0:(_window$YT2$PlayerSta=_window$YT2.PlayerState)===null||_window$YT2$PlayerSta===void 0?void 0:_window$YT2$PlayerSta.PLAYING)&&_this.state.currentMediaPaused||e.data===((_window$YT3=window.YT)===null||_window$YT3===void 0?void 0:(_window$YT3$PlayerSta=_window$YT3.PlayerState)===null||_window$YT3$PlayerSta===void 0?void 0:_window$YT3$PlayerSta.PAUSED)&&!_this.state.currentMediaPaused)){var _window$YT4,_window$YT4$PlayerSta;_this.ytDebounce=false;if(e.data===((_window$YT4=window.YT)===null||_window$YT4===void 0?void 0:(_window$YT4$PlayerSta=_window$YT4.PlayerState)===null||_window$YT4$PlayerSta===void 0?void 0:_window$YT4$PlayerSta.PLAYING)){_this.socket.emit('CMD:play');_this.doPlay();}else{_this.socket.emit('CMD:pause');_this.doPause();}window.setTimeout(function(){return _this.ytDebounce=true;},500);}}}});};};_this.init=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var roomId,query,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// Load room ID from url\nroomId='/default';query=window.location.hash.substring(1);if(query){roomId='/'+query;}// if a vanity name, resolve the url to a room id\nif(!_this.props.vanity){_context3.next=20;break;}_context3.prev=4;_context3.next=7;return axios.get(serverPath+'/resolveRoom/'+_this.props.vanity);case 7:response=_context3.sent;if(!response.data.roomId){_context3.next=12;break;}roomId=response.data.roomId;_context3.next=13;break;case 12:throw new Error('failed to resolve room name');case 13:_context3.next=20;break;case 15:_context3.prev=15;_context3.t0=_context3[\"catch\"](4);console.error(_context3.t0);_this.setState({error:\"There's no room with this name.\"});return _context3.abrupt(\"return\");case 20:_this.setState({roomId:roomId});_this.join(roomId);case 22:case\"end\":return _context3.stop();}}},_callee3,null,[[4,15]]);}));_this.join=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(roomId){var password,savedPasswordsString,savedPasswords,socket;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:password='';try{savedPasswordsString=window.localStorage.getItem('watchparty-passwords');savedPasswords=JSON.parse(savedPasswordsString||'{}');_this.setState({savedPasswords:savedPasswords});password=savedPasswords[roomId]||'';}catch(e){console.warn('[ALERT] Could not parse saved passwords');}socket=io.connect(serverPath+roomId,{transports:['websocket'],query:{clientId:getAndSaveClientId(),password:password}});_this.socket=socket;socket.on('connect',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var canAutoplay,userName;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return testAutoplay();case 2:canAutoplay=_context4.sent;_this.setState({isAutoPlayable:canAutoplay});_this.setState({state:'connected'});// Load username from localstorage\nuserName=window.localStorage.getItem('watchparty-username');_this.updateName(null,{value:userName||generateName()});// if (!this.state.user && firebaseConfig) {\n//   await firebase.auth().signInAnonymously();\n// }\n_this.loadSignInData();case 8:case\"end\":return _context4.stop();}}},_callee4);})));socket.on('error',function(err){console.error(err);if(err==='Invalid namespace'){_this.setState({error:\"There's no room with this name.\"});}else if(err==='not authorized'){_this.setState({isErrorAuth:true});}else{_this.setState({error:'An error occurred.'});}});socket.on('errorMessage',function(err){_this.setState({errorMessage:err});setTimeout(function(){_this.setState({errorMessage:''});},3000);});socket.on('successMessage',function(success){_this.setState({successMessage:success});setTimeout(function(){_this.setState({successMessage:''});},3000);});socket.on('REC:play',function(){_this.doPlay();});socket.on('REC:pause',function(){_this.doPause();});socket.on('REC:seek',function(data){_this.doSeek(data);});socket.on('REC:subtitle',function(data){_this.setState({currentSubtitle:serverPath+'/subtitle/'+data},function(){if(!_this.isSubtitled()){_this.toggleSubtitle();}});});socket.on('REC:changeController',function(data){_this.setState({controller:data});});socket.on('REC:host',function(data){var currentMedia=data.video||'';if(_this.isScreenShare()&&!currentMedia.startsWith('screenshare://')){_this.stopScreenShare();}if(_this.isFileShare()&&!currentMedia.startsWith('fileshare://')){_this.stopScreenShare();}if(_this.isScreenShare()&&currentMedia.startsWith('screenshare://')){// Ignore, it's probably a reconnection\nreturn;}if(_this.isFileShare()&&currentMedia.startsWith('fileshare://')){// Ignore, it's probably a reconnection\nreturn;}if(_this.isVBrowser()&&!currentMedia.startsWith('vbrowser://')){_this.stopVBrowser();}_this.setState({currentMedia:currentMedia,currentMediaPaused:data.paused,currentSubtitle:Boolean(data.subtitle)?serverPath+'/subtitle/'+data.subtitle:'',loading:Boolean(data.video),nonPlayableMedia:false,isVBrowserLarge:data.isVBrowserLarge,vBrowserResolution:data.isVBrowserLarge?'1920x1080@30':'1280x720@30',controller:data.controller},function(){var _this$watchPartyYTPla;if(_this.state.isScreenSharingFile||_this.isVBrowser()&&_this.getVBrowserHost()){console.log('skipping REC:host video since fileshare is using leftVideo or this is a vbrowser');_this.setLoadingFalse();return;}// Stop all players\nvar leftVideo=document.getElementById('leftVideo');leftVideo===null||leftVideo===void 0?void 0:leftVideo.pause();(_this$watchPartyYTPla=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla===void 0?void 0:_this$watchPartyYTPla.stopVideo();// If we can't autoplay, start muted\nif(!_this.state.isAutoPlayable){_this.setMute(true);}if(_this.isYouTube()&&!_this.watchPartyYTPlayer){console.log('YT player not ready, onReady callback will retry when it is');}else if(_this.isVBrowser()){console.log('not playing video as this is a vbrowser:// placeholder');}else{// Start this video\n_this.doSrc(data.video,data.videoTS);if(!data.paused){_this.doPlay();}if(data.subtitle){if(!_this.isSubtitled()){_this.toggleSubtitle();}}// One time, when we're ready to play\nleftVideo===null||leftVideo===void 0?void 0:leftVideo.addEventListener('canplay',function(){_this.setLoadingFalse();_this.jumpToLeader();},{once:true});// Progress updater\nwindow.clearInterval(_this.progressUpdater);_this.setState({downloaded:0,total:0,speed:0});if(currentMedia.includes('/stream?torrent=magnet')){_this.progressUpdater=window.setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var response,data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return window.fetch(currentMedia.replace('/stream','/progress'));case 2:response=_context5.sent;_context5.next=5;return response.json();case 5:data=_context5.sent;_this.setState({downloaded:data.downloaded,total:data.total,speed:data.speed,connections:data.connections});case 7:case\"end\":return _context5.stop();}}},_callee5);})),1000);}}});});socket.on('REC:chat',function(data){if(!getCurrentSettings().disableChatSound&&document.visibilityState&&document.visibilityState!=='visible'){new Audio('/clearly.mp3').play();}_this.state.chat.push(data);_this.setState({chat:_this.state.chat,scrollTimestamp:Number(new Date())});});socket.on('REC:tsMap',function(data){_this.setState({tsMap:data});_this.syncSubtitle();});socket.on('REC:nameMap',function(data){_this.setState({nameMap:data});});socket.on('REC:pictureMap',function(data){_this.setState({pictureMap:data});});socket.on('REC:lock',function(data){_this.setState({roomLock:data});});socket.on('roster',function(data){_this.setState({participants:data,rosterUpdateTS:Number(new Date())},function(){_this.updateScreenShare();});});socket.on('chatinit',function(data){_this.setState({chat:data,scrollTimestamp:Number(new Date())});});socket.on('signalSS',/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(data){var msg,from,pc,answer;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:// Handle messages received from signaling server\nmsg=data.msg;from=data.from;// Determine whether the message came from the sharer or the sharee\npc=data.sharer?_this.screenSharePC:_this.screenHostPC[from];if(!(msg.ice!==undefined)){_context6.next=7;break;}pc.addIceCandidate(new RTCIceCandidate(msg.ice));_context6.next=19;break;case 7:if(!(msg.sdp&&msg.sdp.type==='offer')){_context6.next=18;break;}_context6.next=10;return pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));case 10:_context6.next=12;return pc.createAnswer();case 12:answer=_context6.sent;_context6.next=15;return pc.setLocalDescription(answer);case 15:_this.sendSignalSS(from,{sdp:pc.localDescription},!data.sharer);_context6.next=19;break;case 18:if(msg.sdp&&msg.sdp.type==='answer'){pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));}case 19:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x2){return _ref7.apply(this,arguments);};}());window.setInterval(function(){if(_this.state.currentMedia){_this.socket.emit('CMD:ts',_this.getCurrentTime());}},1000);case 23:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x){return _ref4.apply(this,arguments);};}();_this.setupFileShare=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var files,file,leftVideo,stream;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return openFileSelector();case 2:files=_context8.sent;if(files){_context8.next=5;break;}return _context8.abrupt(\"return\");case 5:file=files[0];leftVideo=document.getElementById('leftVideo');leftVideo.srcObject=null;leftVideo.src=URL.createObjectURL(file);leftVideo.play();//@ts-ignore\nstream=leftVideo.captureStream();// Can render video to a canvas to resize it, reduce size\nstream.onaddtrack=function(){console.log(stream,stream.getVideoTracks(),stream.getAudioTracks());if(!_this.screenShareStream&&stream.getVideoTracks().length&&stream.getAudioTracks().length){stream.getVideoTracks()[0].onended=_this.stopScreenShare;_this.screenShareStream=stream;_this.socket.emit('CMD:joinScreenShare',{file:true});_this.setState({isScreenSharing:true,isScreenSharingFile:true});stream.onaddtrack=undefined;}};case 12:case\"end\":return _context8.stop();}}},_callee8);}));_this.setupScreenShare=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var stream;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return navigator.mediaDevices.getDisplayMedia({video:{cursor:'never',height:720,logicalSurface:true},audio:true});case 2:stream=_context9.sent;stream.getVideoTracks()[0].onended=_this.stopScreenShare;_this.screenShareStream=stream;_this.socket.emit('CMD:joinScreenShare');_this.setState({isScreenSharing:true});case 7:case\"end\":return _context9.stop();}}},_callee9);}));_this.stopScreenShare=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_this.screenShareStream&&_this.screenShareStream.getTracks().forEach(function(track){track.stop();});_this.screenShareStream=undefined;if(_this.screenSharePC){_this.screenSharePC.close();_this.screenSharePC=undefined;}Object.values(_this.screenHostPC).forEach(function(pc){pc.close();});_this.screenHostPC={};if(_this.state.isScreenSharing){_this.socket.emit('CMD:leaveScreenShare');}_this.setState({isScreenSharing:false,isScreenSharingFile:false});case 7:case\"end\":return _context10.stop();}}},_callee10);}));_this.updateScreenShare=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(){var sharer,pc;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:if(!(!_this.isScreenShare()&&!_this.isFileShare())){_context12.next=2;break;}return _context12.abrupt(\"return\");case 2:// TODO teardown for those who leave\nsharer=_this.state.participants.find(function(p){return p.isScreenShare;});if(sharer&&sharer.id===_this.socket.id){// We're the sharer, create a connection to each other member\n_this.state.participants.forEach(function(user){var id=user.id;if(id===_this.socket.id&&_this.state.isScreenSharingFile){// Don't set up a connection to ourselves if sharing file\nreturn;}if(!_this.screenHostPC[id]){// Set up the RTCPeerConnection for sharing media to each member\nvar pc=new RTCPeerConnection({iceServers:iceServers()});_this.screenHostPC[id]=pc;//@ts-ignore\npc.addStream(_this.screenShareStream);pc.onicecandidate=function(event){// We generated an ICE candidate, send it to peer\nif(event.candidate){_this.sendSignalSS(id,{ice:event.candidate},true);}};pc.onnegotiationneeded=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){var offer;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return pc.createOffer();case 2:offer=_context11.sent;_context11.next=5;return pc.setLocalDescription(offer);case 5:_this.sendSignalSS(id,{sdp:pc.localDescription},true);case 6:case\"end\":return _context11.stop();}}},_callee11);}));}});}// We're a watcher, establish connection to sharer\n// If screensharing, sharer also does this\n// If filesharing, sharer does not do this since we use leftVideo\nif(sharer&&!_this.screenSharePC&&!_this.state.isScreenSharingFile){pc=new RTCPeerConnection({iceServers:iceServers()});_this.screenSharePC=pc;pc.onicecandidate=function(event){// We generated an ICE candidate, send it to peer\nif(event.candidate){_this.sendSignalSS(sharer.id,{ice:event.candidate});}};//@ts-ignore\npc.onaddstream=function(event){console.log('stream from webrtc peer');// Mount the stream from peer\nvar stream=event.stream;// console.log(stream);\nvar leftVideo=document.getElementById('leftVideo');if(leftVideo){leftVideo.src='';leftVideo.srcObject=stream;if(!_this.state.isAutoPlayable){_this.setMute(true);}leftVideo.play();}};}case 5:case\"end\":return _context12.stop();}}},_callee12);}));_this.setupVBrowser=/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(rcToken,options){var user,uid,token;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:// user.uid is the public user identifier\n// user.getIdToken() is the secret access token we can send to the server to prove identity\nuser=_this.state.user;uid=user===null||user===void 0?void 0:user.uid;_context13.next=4;return user===null||user===void 0?void 0:user.getIdToken();case 4:token=_context13.sent;_this.socket.emit('CMD:startVBrowser',{options:options,uid:uid,token:token,rcToken:rcToken});case 6:case\"end\":return _context13.stop();}}},_callee13);}));return function(_x3,_x4){return _ref13.apply(this,arguments);};}();_this.stopVBrowser=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(){return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_this.socket.emit('CMD:stopVBrowser');case 1:case\"end\":return _context14.stop();}}},_callee14);}));_this.changeController=/*#__PURE__*/function(){var _ref15=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee15(e,data){return _regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:// console.log(data);\n_this.socket.emit('CMD:changeController',data.value);case 1:case\"end\":return _context15.stop();}}},_callee15);}));return function(_x5,_x6){return _ref15.apply(this,arguments);};}();_this.setSubtitle=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee16(){var files,file,reader;return _regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:_context16.next=2;return openFileSelector('.srt');case 2:files=_context16.sent;if(files){_context16.next=5;break;}return _context16.abrupt(\"return\");case 5:file=files[0];reader=new FileReader();reader.addEventListener('load',function(event){var _event$target;var subData=(_event$target=event.target)===null||_event$target===void 0?void 0:_event$target.result;_this.socket.emit('CMD:subtitle',subData);});reader.readAsText(file);case 9:case\"end\":return _context16.stop();}}},_callee16);}));_this.sendSignalSS=/*#__PURE__*/function(){var _ref17=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee17(to,data,sharer){return _regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:// console.log('sendSS', to, data);\n_this.socket.emit('signalSS',{to:to,msg:data,sharer:sharer});case 1:case\"end\":return _context17.stop();}}},_callee17);}));return function(_x7,_x8,_x9){return _ref17.apply(this,arguments);};}();_this.isYouTube=function(){return getMediaType(_this.state.currentMedia)==='youtube';};_this.isVideo=function(){return getMediaType(_this.state.currentMedia)==='video';};_this.isScreenShare=function(){return _this.state.currentMedia.startsWith('screenshare://');};_this.isFileShare=function(){return _this.state.currentMedia.startsWith('fileshare://');};_this.isVBrowser=function(){return _this.state.currentMedia.startsWith('vbrowser://');};_this.isHttp=function(){return _this.state.currentMedia.startsWith('http');};_this.getVBrowserPass=function(){return _this.state.currentMedia.replace('vbrowser://','').split('@')[0];};_this.getVBrowserHost=function(){return _this.state.currentMedia.replace('vbrowser://','').split('@')[1];};_this.getCurrentTime=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo===null||leftVideo===void 0?void 0:leftVideo.currentTime;}if(_this.isYouTube()){var _this$watchPartyYTPla2;return(_this$watchPartyYTPla2=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla2===void 0?void 0:_this$watchPartyYTPla2.getCurrentTime();}};_this.getDuration=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo.duration;}if(_this.isYouTube()){var _this$watchPartyYTPla3;return(_this$watchPartyYTPla3=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla3===void 0?void 0:_this$watchPartyYTPla3.getDuration();}return 0;};_this.isPaused=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo.paused||leftVideo.ended;}if(_this.isYouTube()){var _this$watchPartyYTPla4,_window$YT5,_window$YT5$PlayerSta,_this$watchPartyYTPla5,_window$YT6,_window$YT6$PlayerSta;return((_this$watchPartyYTPla4=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla4===void 0?void 0:_this$watchPartyYTPla4.getPlayerState())===((_window$YT5=window.YT)===null||_window$YT5===void 0?void 0:(_window$YT5$PlayerSta=_window$YT5.PlayerState)===null||_window$YT5$PlayerSta===void 0?void 0:_window$YT5$PlayerSta.PAUSED)||((_this$watchPartyYTPla5=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla5===void 0?void 0:_this$watchPartyYTPla5.getPlayerState())===((_window$YT6=window.YT)===null||_window$YT6===void 0?void 0:(_window$YT6$PlayerSta=_window$YT6.PlayerState)===null||_window$YT6$PlayerSta===void 0?void 0:_window$YT6$PlayerSta.ENDED);}return false;};_this.isMuted=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo===null||leftVideo===void 0?void 0:leftVideo.muted;}if(_this.isYouTube()){var _this$watchPartyYTPla6;return(_this$watchPartyYTPla6=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla6===void 0?void 0:_this$watchPartyYTPla6.isMuted();}return false;};_this.isSubtitled=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo.textTracks[0]&&leftVideo.textTracks[0].mode==='showing';}if(_this.isYouTube()){try{var _this$watchPartyYTPla7;var current=(_this$watchPartyYTPla7=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla7===void 0?void 0:_this$watchPartyYTPla7.getOption('captions','track');return Boolean(current&&current.languageCode);}catch(e){console.warn(e);return false;}}return false;};_this.jumpToLeader=function(){// Jump to the leader's position\nvar maxTS=_this.getLeaderTime();if(maxTS>0){console.log('jump to leader at ',maxTS);_this.doSeek(maxTS);}};_this.doSrc=/*#__PURE__*/function(){var _ref18=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee18(src,time){var leftVideo,_this$watchPartyYTPla8,url,videoId,altVideoId;return _regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:console.log('doSrc',src,time);if(!(_this.isScreenShare()||_this.isFileShare()||_this.isVBrowser())){_context18.next=3;break;}return _context18.abrupt(\"return\");case 3:if(_this.isVideo()){leftVideo=document.getElementById('leftVideo');if(leftVideo){leftVideo.srcObject=null;leftVideo.src=src;leftVideo.currentTime=time;// Clear subtitles\nleftVideo.innerHTML='';}}if(_this.isYouTube()){url=new window.URL(src);// Standard link https://www.youtube.com/watch?v=ID\nvideoId=querystring.parse(url.search.substring(1))['v'];// Link shortener https://youtu.be/ID\naltVideoId=src.split('/').slice(-1)[0];(_this$watchPartyYTPla8=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla8===void 0?void 0:_this$watchPartyYTPla8.cueVideoById(videoId||altVideoId,time);}case 5:case\"end\":return _context18.stop();}}},_callee18);}));return function(_x10,_x11){return _ref18.apply(this,arguments);};}();_this.doPlay=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee20(){return _regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_this.setState({currentMediaPaused:false},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee19(){var leftVideo,_this$watchPartyYTPla9;return _regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:if(!_this.isVideo()){_context19.next=11;break;}leftVideo=document.getElementById('leftVideo');_context19.prev=2;_context19.next=5;return leftVideo===null||leftVideo===void 0?void 0:leftVideo.play();case 5:_context19.next=11;break;case 7:_context19.prev=7;_context19.t0=_context19[\"catch\"](2);// console.warn(e);\nconsole.warn(_context19.t0.name);if(_context19.t0.name==='NotSupportedError'){_this.setState({loading:false,nonPlayableMedia:true});}case 11:if(_this.isYouTube()){console.log('play yt');(_this$watchPartyYTPla9=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla9===void 0?void 0:_this$watchPartyYTPla9.playVideo();}case 12:case\"end\":return _context19.stop();}}},_callee19,null,[[2,7]]);})));case 1:case\"end\":return _context20.stop();}}},_callee20);}));_this.doPause=function(){_this.setState({currentMediaPaused:true},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee21(){var leftVideo,_this$watchPartyYTPla10;return _regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:if(_this.isVideo()){leftVideo=document.getElementById('leftVideo');leftVideo.pause();}if(_this.isYouTube()){console.log('pause');(_this$watchPartyYTPla10=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla10===void 0?void 0:_this$watchPartyYTPla10.pauseVideo();}case 2:case\"end\":return _context21.stop();}}},_callee21);})));};_this.doSeek=function(time){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');leftVideo.currentTime=time;}if(_this.isYouTube()){var _this$watchPartyYTPla11;(_this$watchPartyYTPla11=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla11===void 0?void 0:_this$watchPartyYTPla11.seekTo(time,true);}};_this.togglePlay=function(){var shouldPlay=true;if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');shouldPlay=leftVideo.paused||leftVideo.ended;}else if(_this.isYouTube()){var _this$watchPartyYTPla12,_window$YT7;shouldPlay=((_this$watchPartyYTPla12=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla12===void 0?void 0:_this$watchPartyYTPla12.getPlayerState())===((_window$YT7=window.YT)===null||_window$YT7===void 0?void 0:_window$YT7.PlayerState.PAUSED)||_this.getCurrentTime()===_this.getDuration();}if(shouldPlay){_this.socket.emit('CMD:play');_this.doPlay();}else{_this.socket.emit('CMD:pause');_this.doPause();}};_this.onSeek=function(e,time){var target=time;if(e){var rect=e.target.getBoundingClientRect();var x=e.clientX-rect.left;var max=rect.width;target=x/max*_this.getDuration();}target=Math.max(target,0);_this.doSeek(target);_this.socket.emit('CMD:seek',target);};_this.onVideoKeydown=function(e){if(e.key===' '){e.preventDefault();_this.togglePlay();}else if(e.key==='ArrowRight'){_this.onSeek(null,_this.getCurrentTime()+10);}else if(e.key==='ArrowLeft'){_this.onSeek(null,_this.getCurrentTime()-10);}else if(e.key==='c'){_this.toggleSubtitle();}else if(e.key==='t'){_this.fullScreen(false);}else if(e.key==='f'){_this.fullScreen(true);}else if(e.key==='m'){_this.toggleMute();}};_this.fullScreen=/*#__PURE__*/function(){var _ref22=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee22(bVideoOnly){var container,bChangeElements;return _regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:container=document.getElementById('fullScreenContainer');if(bVideoOnly||isMobile()){container=document.getElementById(_this.isYouTube()?'leftYt':'leftVideo');}if(document.fullscreenElement){_context22.next=6;break;}_context22.next=5;return container.requestFullscreen();case 5:return _context22.abrupt(\"return\");case 6:bChangeElements=document.fullscreenElement!==container;_context22.next=9;return document.exitFullscreen();case 9:if(!bChangeElements){_context22.next=12;break;}_context22.next=12;return container.requestFullscreen();case 12:case\"end\":return _context22.stop();}}},_callee22);}));return function(_x12){return _ref22.apply(this,arguments);};}();_this.toggleMute=function(){_this.setMute(!_this.isMuted());};_this.setMute=function(muted){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');if(leftVideo){leftVideo.muted=muted;}}if(_this.isYouTube()){if(muted){var _this$watchPartyYTPla13;(_this$watchPartyYTPla13=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla13===void 0?void 0:_this$watchPartyYTPla13.mute();}else{var _this$watchPartyYTPla14;(_this$watchPartyYTPla14=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla14===void 0?void 0:_this$watchPartyYTPla14.unMute();}}};_this.setVolume=function(volume){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');leftVideo.volume=volume;}if(_this.isYouTube()){var _this$watchPartyYTPla15;(_this$watchPartyYTPla15=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla15===void 0?void 0:_this$watchPartyYTPla15.setVolume(volume*100);}};_this.getVolume=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo.volume;}if(_this.isYouTube()){var _this$watchPartyYTPla16;var volume=(_this$watchPartyYTPla16=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla16===void 0?void 0:_this$watchPartyYTPla16.getVolume();return volume/100;}};_this.loadSubtitles=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee23(){var leftVideo,subtitleSrc,src,subtitlePath,response,buffer,vttConverter,url,track;return _regeneratorRuntime.wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:leftVideo=document.getElementById('leftVideo');// Clear subtitles\nleftVideo.innerHTML='';subtitleSrc='';src=_this.state.currentMedia;if(_this.state.currentSubtitle){subtitleSrc=_this.state.currentSubtitle;}else if(src.includes('/stream?torrent=magnet')){subtitleSrc=src.replace('/stream','/subtitles2');}else if(src.startsWith('http')){subtitlePath=src.slice(0,src.lastIndexOf('/')+1);// Expect subtitle name to be file name + .srt\nsubtitleSrc=subtitlePath+'subtitles/'+_this.getFileName(src)+'.srt';}if(!subtitleSrc){_context23.next=23;break;}_context23.next=8;return window.fetch(subtitleSrc);case 8:response=_context23.sent;_context23.next=11;return response.arrayBuffer();case 11:buffer=_context23.sent;vttConverter=new VTTConverter(new Blob([buffer]));_context23.next=15;return vttConverter.getURL();case 15:url=_context23.sent;track=document.createElement('track');track.kind='captions';track.label='English';track.srclang='en';track.src=url;leftVideo.appendChild(track);leftVideo.textTracks[0].mode='showing';case 23:case\"end\":return _context23.stop();}}},_callee23);}));_this.syncSubtitle=function(){var sharer=_this.state.participants.find(function(p){return p.isScreenShare;});if(!sharer||sharer.id===_this.socket.id){return;}// When sharing, our timestamp doesn't match the subtitles so adjust them\n// For each cue, subtract the videoTS of the sharer, then add our own\nvar leftVideo=document.getElementById('leftVideo');var track=leftVideo===null||leftVideo===void 0?void 0:leftVideo.textTracks[0];var offset=leftVideo.currentTime-_this.state.tsMap[sharer.id];if(track&&offset&&track.cues){for(var i=0;i<track.cues.length;i++){var cue=track.cues[i];// console.log(cue.text, offset, (cue as any).origStart, (cue as any).origEnd);\nif(!cue.origStart){cue.origStart=cue.startTime;cue.origEnd=cue.endTime;}cue.startTime=cue.origStart+offset;cue.endTime=cue.origEnd+offset;}}};_this.toggleSubtitle=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');if(_this.isSubtitled()){leftVideo.innerHTML='';}else{_this.loadSubtitles();}}if(_this.isYouTube()){var isSubtitled=_this.isSubtitled();// console.log(isSubtitled);\nif(isSubtitled){var _this$watchPartyYTPla17;// BUG this doesn't actually set the value so subtitles can't be toggled off\n(_this$watchPartyYTPla17=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla17===void 0?void 0:_this$watchPartyYTPla17.setOption('captions','track',{});}else{var _this$watchPartyYTPla18,_this$watchPartyYTPla19,_this$watchPartyYTPla20;(_this$watchPartyYTPla18=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla18===void 0?void 0:_this$watchPartyYTPla18.setOption('captions','reload',true);var tracks=(_this$watchPartyYTPla19=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla19===void 0?void 0:_this$watchPartyYTPla19.getOption('captions','tracklist');(_this$watchPartyYTPla20=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla20===void 0?void 0:_this$watchPartyYTPla20.setOption('captions','track',tracks[0]);}}};_this.setMedia=function(e,data){_this.socket.emit('CMD:host',data.value);};_this.launchMultiSelect=function(data){_this.setState({multiStreamSelection:data});};_this.resetMultiSelect=function(){_this.setState({multiStreamSelection:undefined});};_this.updateName=function(e,data){_this.setState({myName:data.value});_this.socket.emit('CMD:name',data.value);window.localStorage.setItem('watchparty-username',data.value);};_this.updatePicture=function(url){_this.setState({myPicture:url});_this.socket.emit('CMD:picture',url);};_this.updateUid=/*#__PURE__*/function(){var _ref24=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee24(user){var uid,token;return _regeneratorRuntime.wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:uid=user.uid;_context24.next=3;return user.getIdToken();case 3:token=_context24.sent;_this.socket.emit('CMD:uid',{uid:uid,token:token});case 5:case\"end\":return _context24.stop();}}},_callee24);}));return function(_x13){return _ref24.apply(this,arguments);};}();_this.getMediaDisplayName=function(input){if(!input){return'';}// Show the whole URL for youtube\nif(getMediaType(input)==='youtube'){return input;}if(input.startsWith('screenshare://')){var id=input.slice('screenshare://'.length);return _this.state.nameMap[id]+\"'s screen\";}if(input.startsWith('fileshare://')){var _id=input.slice('fileshare://'.length);return _this.state.nameMap[_id]+\"'s file\";}if(input.startsWith('vbrowser://')){return'Virtual Browser'+(_this.state.isVBrowserLarge?'+':'');}if(input.includes('/stream?torrent=magnet')){var search=new URL(input).search;var magnetUrl=querystring.parse(search.substring(1)).torrent;var magnetParsed=magnet.decode(magnetUrl);return magnetParsed.name;}// Get the filename out of the URL\nreturn input;};_this.getFileName=function(input){return input.split('/').slice(-1)[0];};_this.setLoadingFalse=function(){_this.setState({loading:false});};_this.onManage=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee25(){var _this$state$user,_this$state$user2;var resp,session;return _regeneratorRuntime.wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:_context25.t0=window;_context25.t1=serverPath+'/manageSub';_context25.t2={'Content-Type':'application/json'};_context25.t3=JSON;_context25.t4=(_this$state$user=_this.state.user)===null||_this$state$user===void 0?void 0:_this$state$user.uid;_context25.next=7;return(_this$state$user2=_this.state.user)===null||_this$state$user2===void 0?void 0:_this$state$user2.getIdToken();case 7:_context25.t5=_context25.sent;_context25.t6=window.location.href;_context25.t7={uid:_context25.t4,token:_context25.t5,return_url:_context25.t6};_context25.t8=_context25.t3.stringify.call(_context25.t3,_context25.t7);_context25.t9={method:'POST',headers:_context25.t2,body:_context25.t8};_context25.next=14;return _context25.t0.fetch.call(_context25.t0,_context25.t1,_context25.t9);case 14:resp=_context25.sent;_context25.next=17;return resp.json();case 17:session=_context25.sent;console.log(session);window.location.assign(session.url);case 20:case\"end\":return _context25.stop();}}},_callee25);}));_this.setRoomLock=/*#__PURE__*/function(){var _ref26=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee26(locked){var _this$state$user3,_this$state$user4;var uid,token;return _regeneratorRuntime.wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:uid=(_this$state$user3=_this.state.user)===null||_this$state$user3===void 0?void 0:_this$state$user3.uid;_context26.next=3;return(_this$state$user4=_this.state.user)===null||_this$state$user4===void 0?void 0:_this$state$user4.getIdToken();case 3:token=_context26.sent;_this.socket.emit('CMD:lock',{uid:uid,token:token,locked:locked});case 5:case\"end\":return _context26.stop();}}},_callee26);}));return function(_x14){return _ref26.apply(this,arguments);};}();_this.haveLock=function(){var _this$state$user5;if(!_this.state.roomLock){return true;}return((_this$state$user5=_this.state.user)===null||_this$state$user5===void 0?void 0:_this$state$user5.uid)===_this.state.roomLock;};_this.getLeaderTime=function(){return Math.max.apply(Math,_toConsumableArray(Object.values(_this.state.tsMap)));};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee29(){var _this2=this;return _regeneratorRuntime.wrap(function _callee29$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:document.onfullscreenchange=function(){_this2.setState({fullScreen:Boolean(document.fullscreenElement)});};// Send heartbeat to the server\nwindow.setInterval(function(){window.fetch(serverPath+'/ping');},10*60*1000);if(firebaseConfig){firebase.auth().onAuthStateChanged(/*#__PURE__*/function(){var _ref27=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee28(user){return _regeneratorRuntime.wrap(function _callee28$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:if(user){// console.log(user);\n_this2.setState({user:user},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee27(){return _regeneratorRuntime.wrap(function _callee27$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:_this2.loadSignInData();case 1:case\"end\":return _context27.stop();}}},_callee27);})));}case 1:case\"end\":return _context28.stop();}}},_callee28);}));return function(_x15){return _ref27.apply(this,arguments);};}());}this.loadSettings();this.loadYouTube();this.init();case 6:case\"end\":return _context29.stop();}}},_callee29,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this3=this,_this$socket;var sharer=this.state.participants.find(function(p){return p.isScreenShare;});var controls=/*#__PURE__*/React.createElement(Controls,{key:this.state.controlsTimestamp,togglePlay:this.togglePlay,onSeek:this.onSeek,fullScreen:this.fullScreen,toggleMute:this.toggleMute,toggleSubtitle:this.toggleSubtitle,setVolume:this.setVolume,getVolume:this.getVolume,jumpToLeader:this.jumpToLeader,paused:this.isPaused(),muted:this.isMuted(),subtitled:this.isSubtitled(),currentTime:this.getCurrentTime(),duration:this.getDuration(),disabled:!this.haveLock(),leaderTime:this.isHttp()?this.getLeaderTime():undefined});return/*#__PURE__*/React.createElement(React.Fragment,null,this.state.multiStreamSelection&&/*#__PURE__*/React.createElement(MultiStreamModal,{streams:this.state.multiStreamSelection,setMedia:this.setMedia,resetMultiSelect:this.resetMultiSelect}),this.state.isSubscribeModalOpen&&/*#__PURE__*/React.createElement(SubscribeModal,{user:this.state.user,isSubscriber:this.state.isSubscriber,closeSubscribe:function closeSubscribe(){return _this3.setState({isSubscribeModalOpen:false});}}),this.state.isVBrowserModalOpen&&/*#__PURE__*/React.createElement(VBrowserModal,{isSubscriber:this.state.isSubscriber,closeModal:function closeModal(){return _this3.setState({isVBrowserModalOpen:false});},openSubscribe:function openSubscribe(){return _this3.setState({isSubscribeModalOpen:true});},startVBrowser:this.setupVBrowser}),this.state.error&&/*#__PURE__*/React.createElement(ErrorModal,{error:this.state.error}),this.state.isErrorAuth&&/*#__PURE__*/React.createElement(PasswordModal,{savedPasswords:this.state.savedPasswords,roomId:this.state.roomId}),this.state.errorMessage&&/*#__PURE__*/React.createElement(Message,{negative:true,header:\"Error\",content:this.state.errorMessage,style:{position:'fixed',bottom:'10px',right:'10px'}}),this.state.successMessage&&/*#__PURE__*/React.createElement(Message,{positive:true,header:\"Success\",content:this.state.successMessage,style:{position:'fixed',bottom:'10px',right:'10px'}}),!this.state.error&&!this.state.isAutoPlayable&&/*#__PURE__*/React.createElement(Modal,{inverted:true,basic:true,open:true},/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',justifyContent:'center'}},/*#__PURE__*/React.createElement(Button,{primary:true,size:\"huge\",onClick:function onClick(){_this3.setState({isAutoPlayable:true});_this3.setMute(false);},icon:true,labelPosition:\"left\"},/*#__PURE__*/React.createElement(Icon,{name:\"sign-in\"}),\"Join Party\"))),/*#__PURE__*/React.createElement(TopBar,{user:this.state.user}),/*#__PURE__*/React.createElement(Grid,{stackable:true,celled:\"internally\"},/*#__PURE__*/React.createElement(Grid.Row,null,/*#__PURE__*/React.createElement(Grid.Column,{width:12,className:\"fullHeightColumn\"},/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',flexDirection:'column',height:'100%'}},/*#__PURE__*/React.createElement(ComboBox,{setMedia:this.setMedia,currentMedia:this.state.currentMedia,getMediaDisplayName:this.getMediaDisplayName,launchMultiSelect:this.launchMultiSelect,streamPath:this.state.settings.streamPath,mediaPath:this.state.settings.mediaPath,disabled:!this.haveLock()}),/*#__PURE__*/React.createElement(Separator,null),/*#__PURE__*/React.createElement(\"div\",{className:\"mobileStack\",style:{display:'flex'}},this.screenShareStream&&/*#__PURE__*/React.createElement(Button,{fluid:true,className:\"toolButton\",icon:true,labelPosition:\"left\",color:\"red\",onClick:this.stopScreenShare,disabled:(sharer===null||sharer===void 0?void 0:sharer.id)!==((_this$socket=this.socket)===null||_this$socket===void 0?void 0:_this$socket.id)},/*#__PURE__*/React.createElement(Icon,{name:\"cancel\"}),\"Stop Share\"),!this.screenShareStream&&!sharer&&!this.isVBrowser()&&/*#__PURE__*/React.createElement(Popup,{content:\"Share a tab or an application. Make sure to check \\\"Share audio\\\" for best results.\",trigger:/*#__PURE__*/React.createElement(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",color:'instagram',onClick:this.setupScreenShare},/*#__PURE__*/React.createElement(Icon,{name:'slideshare'}),\"Screenshare\")}),!this.screenShareStream&&!sharer&&!this.isVBrowser()&&/*#__PURE__*/React.createElement(Popup,{content:\"Launch a shared virtual browser\",trigger:/*#__PURE__*/React.createElement(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",color:\"green\",onClick:function onClick(){_this3.setState({isVBrowserModalOpen:true});}},/*#__PURE__*/React.createElement(Icon,{name:\"desktop\"}),\"VBrowser\")}),this.isVBrowser()&&/*#__PURE__*/React.createElement(Popup,{content:\"Choose the person controlling the VBrowser\",trigger:/*#__PURE__*/React.createElement(Dropdown,{icon:\"keyboard\",labeled:true,className:\"icon\",style:{height:'36px'},button:true,value:this.state.controller,placeholder:\"No controller\",onChange:this.changeController,selection:true,disabled:!this.haveLock(),options:this.state.participants.map(function(p){return{text:_this3.state.nameMap[p.id]||p.id,value:p.id};})})}),this.isVBrowser()&&/*#__PURE__*/React.createElement(Dropdown,{icon:\"desktop\",labeled:true,className:\"icon\",style:{height:'36px'},button:true,disabled:!this.haveLock(),value:this.state.vBrowserResolution,onChange:function onChange(e,data){return _this3.setState({vBrowserResolution:data.value});},selection:true,options:[{text:'1080p',value:'1920x1080@30',disabled:!this.state.isVBrowserLarge},{text:'720p',value:'1280x720@30'},{text:'576p',value:'1024x576@60'},{text:'486p',value:'864x486@60'},{text:'360p',value:'640x360@60'}]}),this.isVBrowser()&&/*#__PURE__*/React.createElement(Button,{fluid:true,className:\"toolButton\",icon:true,labelPosition:\"left\",color:\"red\",disabled:!this.haveLock(),onClick:this.stopVBrowser},/*#__PURE__*/React.createElement(Icon,{name:\"cancel\"}),\"Stop VBrowser\"),!this.screenShareStream&&!sharer&&!this.isVBrowser()&&/*#__PURE__*/React.createElement(Popup,{content:\"Stream your own video file\",trigger:/*#__PURE__*/React.createElement(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",onClick:this.setupFileShare},/*#__PURE__*/React.createElement(Icon,{name:\"file\"}),\"File\")}),false&&/*#__PURE__*/React.createElement(SearchComponent,{setMedia:this.setMedia,type:'youtube',streamPath:this.state.settings.streamPath,mediaPath:this.state.settings.mediaPath,disabled:!this.haveLock()}),Boolean(this.state.settings.mediaPath)&&/*#__PURE__*/React.createElement(SearchComponent,{setMedia:this.setMedia,type:'media',streamPath:this.state.settings.streamPath,mediaPath:this.state.settings.mediaPath,disabled:!this.haveLock()}),Boolean(this.state.settings.streamPath)&&/*#__PURE__*/React.createElement(SearchComponent,{setMedia:this.setMedia,type:'stream',streamPath:this.state.settings.streamPath,mediaPath:this.state.settings.mediaPath,launchMultiSelect:this.launchMultiSelect,disabled:!this.haveLock()}),this.state.currentMedia&&/*#__PURE__*/React.createElement(Popup,{content:\"Upload a .srt subtitle file for this video\",trigger:/*#__PURE__*/React.createElement(Button,{fluid:true,color:\"violet\",className:\"toolButton\",icon:true,labelPosition:\"left\",onClick:this.setSubtitle,disabled:!this.haveLock()},/*#__PURE__*/React.createElement(Icon,{name:\"closed captioning\"}),\"Subtitle\")}),!this.state.isSubscriber&&/*#__PURE__*/React.createElement(Popup,{content:\"Subscribe to help support us and enable additional features!\",trigger:/*#__PURE__*/React.createElement(Button,{fluid:true,color:\"orange\",className:\"toolButton\",icon:true,labelPosition:\"left\",onClick:function onClick(){return _this3.setState({isSubscribeModalOpen:true});}},/*#__PURE__*/React.createElement(Icon,{name:\"plus\"}),\"Subscribe\")}),this.state.isSubscriber&&/*#__PURE__*/React.createElement(Popup,{content:\"Manage your subscription\",trigger:/*#__PURE__*/React.createElement(Button,{fluid:true,color:\"orange\",className:\"toolButton\",icon:true,labelPosition:\"left\",onClick:this.onManage},/*#__PURE__*/React.createElement(Icon,{name:\"wrench\"}),\"Manage\")})),/*#__PURE__*/React.createElement(Separator,null),/*#__PURE__*/React.createElement(\"div\",{id:\"fullScreenContainer\",className:this.state.fullScreen?'fullScreenContainer':'',style:{flexGrow:1}},/*#__PURE__*/React.createElement(\"div\",{id:\"playerContainer\",tabIndex:1,onKeyDown:this.onVideoKeydown},(this.state.loading||!this.state.currentMedia||this.state.nonPlayableMedia)&&/*#__PURE__*/React.createElement(\"div\",{id:\"loader\",className:\"videoContent\",style:{display:'flex',alignItems:'center',justifyContent:'center'}},this.state.loading&&/*#__PURE__*/React.createElement(Dimmer,{active:true},/*#__PURE__*/React.createElement(Loader,null,this.isVBrowser()?'Launching virtual browser. This can take up to a minute.':'')),!this.state.loading&&!this.state.currentMedia&&/*#__PURE__*/React.createElement(Message,{color:\"yellow\",icon:\"hand point up\",header:\"You're not watching anything!\",content:\"Pick something to watch above.\"}),!this.state.loading&&this.state.nonPlayableMedia&&/*#__PURE__*/React.createElement(Message,{color:\"red\",icon:\"frown\",header:\"It doesn't look like this is a media file!\",content:\"Maybe you meant to launch a VBrowser if you're trying to visit a web page?\"})),/*#__PURE__*/React.createElement(\"iframe\",{style:{display:this.isYouTube()&&!this.state.loading?'block':'none'},title:\"YouTube\",id:\"leftYt\",className:\"videoContent\",allowFullScreen:true,frameBorder:\"0\",allow:\"autoplay\",src:\"https://www.youtube.com/embed/?enablejsapi=1&controls=0&rel=0\"}),this.isVBrowser()&&this.getVBrowserPass()&&this.getVBrowserHost()?/*#__PURE__*/React.createElement(VBrowser,{username:this.socket.id,password:this.getVBrowserPass(),hostname:this.getVBrowserHost(),controlling:this.state.controller===this.socket.id,setLoadingFalse:this.setLoadingFalse,resolution:this.state.vBrowserResolution,isAutoPlayable:this.state.isAutoPlayable,setResolution:function setResolution(data){return _this3.setState({vBrowserResolution:data});}}):/*#__PURE__*/React.createElement(\"video\",{style:{display:this.isVideo()&&!this.state.loading?'block':'none',width:'100%'},id:\"leftVideo\"}),this.state.fullScreen&&this.state.currentMedia&&/*#__PURE__*/React.createElement(\"div\",{className:\"controlsContainer\"},controls)),this.state.fullScreen&&/*#__PURE__*/React.createElement(Chat,{className:\"fullScreenChat\",chat:this.state.chat,nameMap:this.state.nameMap,pictureMap:this.state.pictureMap,socket:this.socket,scrollTimestamp:this.state.scrollTimestamp,getMediaDisplayName:this.getMediaDisplayName})),this.state.currentMedia&&controls,Boolean(this.state.total)&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Progress,{size:\"tiny\",color:\"green\",inverted:true,value:this.state.downloaded,total:this.state.total// indicating\n,label:Math.min(this.state.downloaded/this.state.total*100,100).toFixed(2)+'% - '+formatSpeed(this.state.speed)+' - '+this.state.connections+' connections'})))),/*#__PURE__*/React.createElement(Grid.Column,{width:4,style:{display:'flex',flexDirection:'column'},className:\"fullHeightColumn\"},/*#__PURE__*/React.createElement(Input,{inverted:true,fluid:true,label:'Name:',value:this.state.myName,onChange:this.updateName,icon:/*#__PURE__*/React.createElement(Icon,{onClick:function onClick(){return _this3.updateName(null,{value:generateName()});},name:\"refresh\",inverted:true,circular:true,link:true})}),!this.state.fullScreen&&/*#__PURE__*/React.createElement(Menu,{inverted:true,widths:3,style:{marginTop:'4px',marginBottom:'4px'}},/*#__PURE__*/React.createElement(Menu.Item,{name:\"chat\",active:this.state.currentTab==='chat',onClick:function onClick(){return _this3.setState({currentTab:'chat'});},as:\"a\"},\"Chat\"),/*#__PURE__*/React.createElement(Menu.Item,{name:\"people\",active:this.state.currentTab==='people',onClick:function onClick(){return _this3.setState({currentTab:'people'});},as:\"a\"},\"Webcam (\",this.state.participants.length,\")\")),/*#__PURE__*/React.createElement(Chat,{chat:this.state.chat,nameMap:this.state.nameMap,pictureMap:this.state.pictureMap,socket:this.socket,scrollTimestamp:this.state.scrollTimestamp,getMediaDisplayName:this.getMediaDisplayName,hide:this.state.currentTab!=='chat'}),this.state.state==='connected'&&/*#__PURE__*/React.createElement(VideoChat,{socket:this.socket,participants:this.state.participants,nameMap:this.state.nameMap,pictureMap:this.state.pictureMap,tsMap:this.state.tsMap,rosterUpdateTS:this.state.rosterUpdateTS,hide:this.state.currentTab!=='people'}),/*#__PURE__*/React.createElement(SettingsTab,{hide:this.state.currentTab!=='settings',user:this.state.user,roomLock:this.state.roomLock,setRoomLock:this.setRoomLock,socket:this.socket,isSubscriber:this.state.isSubscriber,roomId:this.state.roomId})))));}}]);return App;}(React.Component);export{App as default};export var Separator=function Separator(){return/*#__PURE__*/React.createElement(\"div\",{style:{height:'4px',flexShrink:0}});};","map":{"version":3,"sources":["/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/src/components/App/App.tsx"],"names":["querystring","axios","magnet","React","Button","Dimmer","Dropdown","Grid","Icon","Input","Loader","Message","Modal","Popup","Progress","Menu","io","VTTConverter","formatSpeed","getMediaType","iceServers","isMobile","serverPath","testAutoplay","openFileSelector","getAndSaveClientId","generateName","Chat","TopBar","VBrowser","VideoChat","getCurrentSettings","MultiStreamModal","ComboBox","SearchComponent","Controls","firebase","SubscribeModal","VBrowserModal","SettingsTab","ErrorModal","PasswordModal","firebaseConfig","process","env","REACT_APP_FIREBASE_CONFIG","initializeApp","JSON","parse","App","state","currentMedia","currentMediaPaused","currentSubtitle","participants","rosterUpdateTS","Number","Date","chat","tsMap","nameMap","pictureMap","myName","myPicture","loading","scrollTimestamp","fullScreen","controlsTimestamp","watchOptions","isScreenSharing","isScreenSharingFile","isVBrowser","user","undefined","isYouTubeReady","isAutoPlayable","downloaded","total","speed","connections","multiStreamSelection","error","isErrorAuth","settings","vBrowserResolution","isVBrowserLarge","nonPlayableMedia","currentTab","window","location","search","substring","tab","isSubscriber","isSubscribeModalOpen","isVBrowserModalOpen","roomLock","controller","roomId","savedPasswords","errorMessage","successMessage","socket","watchPartyYTPlayer","ytDebounce","screenShareStream","screenHostPC","screenSharePC","progressUpdater","loadSettings","fetch","customSettingsData","json","customSettings","setState","loadSignInData","firstName","displayName","split","updateName","value","photoURL","updatePicture","updateUid","getIdToken","token","uid","response","data","loadYouTube","tag","document","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","onYouTubeIframeAPIReady","ytPlayer","YT","Player","events","onReady","isYouTube","emit","onStateChange","e","PlayerState","CUED","PLAYING","PAUSED","doPlay","doPause","setTimeout","init","query","hash","props","vanity","get","Error","console","join","password","savedPasswordsString","localStorage","getItem","warn","connect","transports","clientId","on","canAutoplay","userName","err","success","doSeek","isSubtitled","toggleSubtitle","video","isScreenShare","startsWith","stopScreenShare","isFileShare","stopVBrowser","paused","Boolean","subtitle","getVBrowserHost","log","setLoadingFalse","leftVideo","getElementById","pause","stopVideo","setMute","doSrc","videoTS","addEventListener","jumpToLeader","once","clearInterval","includes","setInterval","replace","disableChatSound","visibilityState","Audio","play","push","syncSubtitle","updateScreenShare","msg","from","pc","sharer","ice","addIceCandidate","RTCIceCandidate","sdp","type","setRemoteDescription","RTCSessionDescription","createAnswer","answer","setLocalDescription","sendSignalSS","localDescription","getCurrentTime","setupFileShare","files","file","srcObject","URL","createObjectURL","stream","captureStream","onaddtrack","getVideoTracks","getAudioTracks","length","onended","setupScreenShare","navigator","mediaDevices","getDisplayMedia","cursor","height","logicalSurface","audio","getTracks","forEach","track","stop","close","Object","values","find","p","id","RTCPeerConnection","addStream","onicecandidate","event","candidate","onnegotiationneeded","createOffer","offer","onaddstream","setupVBrowser","rcToken","options","changeController","setSubtitle","reader","FileReader","subData","target","result","readAsText","to","isVideo","isHttp","getVBrowserPass","currentTime","getDuration","duration","isPaused","ended","getPlayerState","ENDED","isMuted","muted","textTracks","mode","current","getOption","languageCode","maxTS","getLeaderTime","time","innerHTML","url","videoId","altVideoId","slice","cueVideoById","name","playVideo","pauseVideo","seekTo","togglePlay","shouldPlay","onSeek","rect","getBoundingClientRect","x","clientX","left","max","width","Math","onVideoKeydown","key","preventDefault","toggleMute","bVideoOnly","container","fullscreenElement","requestFullscreen","bChangeElements","exitFullscreen","mute","unMute","setVolume","volume","getVolume","loadSubtitles","subtitleSrc","subtitlePath","lastIndexOf","getFileName","arrayBuffer","buffer","vttConverter","Blob","getURL","kind","label","srclang","appendChild","offset","cues","i","cue","origStart","startTime","origEnd","endTime","setOption","tracks","setMedia","launchMultiSelect","resetMultiSelect","setItem","getMediaDisplayName","input","magnetUrl","torrent","magnetParsed","decode","onManage","href","return_url","stringify","method","headers","body","resp","session","assign","setRoomLock","locked","haveLock","onfullscreenchange","auth","onAuthStateChanged","controls","position","bottom","right","display","justifyContent","flexDirection","streamPath","mediaPath","map","text","disabled","flexGrow","alignItems","min","toFixed","marginTop","marginBottom","Component","Separator","flexShrink"],"mappings":"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","sourcesContent":["import './App.css';\n\nimport querystring from 'querystring';\nimport axios from 'axios';\n//@ts-ignore\nimport magnet from 'magnet-uri';\nimport React from 'react';\nimport {\n  Button,\n  Dimmer,\n  Dropdown,\n  DropdownProps,\n  Grid,\n  Icon,\n  Input,\n  Loader,\n  Message,\n  Modal,\n  Popup,\n  Progress,\n  Menu,\n} from 'semantic-ui-react';\n//@ts-ignore\nimport io from 'socket.io-client';\n//@ts-ignore\nimport VTTConverter from 'srt-webvtt';\nimport {\n  formatSpeed,\n  getMediaType,\n  iceServers,\n  isMobile,\n  serverPath,\n  testAutoplay,\n  openFileSelector,\n  getAndSaveClientId,\n} from '../../utils';\nimport { generateName } from '../../utils/generateName';\nimport { Chat } from '../Chat';\nimport { TopBar } from '../TopBar';\nimport { VBrowser } from '../VBrowser';\nimport { VideoChat } from '../VideoChat';\nimport { getCurrentSettings } from '../Settings';\nimport { MultiStreamModal } from '../Modal/MultiStreamModal';\nimport { ComboBox } from '../ComboBox/ComboBox';\nimport { SearchComponent } from '../SearchComponent/SearchComponent';\nimport { Controls } from '../Controls/Controls';\nimport firebase from 'firebase/app';\nimport 'firebase/auth';\nimport { SubscribeModal } from '../Modal/SubscribeModal';\nimport { VBrowserModal } from '../Modal/VBrowserModal';\nimport { SettingsTab } from '../Settings/SettingsTab';\nimport { ErrorModal } from '../Modal/ErrorModal';\nimport { PasswordModal } from '../Modal/PasswordModal';\n\nconst firebaseConfig = process.env.REACT_APP_FIREBASE_CONFIG;\nif (firebaseConfig) {\n  firebase.initializeApp(JSON.parse(firebaseConfig));\n}\n\ndeclare global {\n  interface Window {\n    onYouTubeIframeAPIReady: any;\n    YT: any;\n    FB: any;\n    fbAsyncInit: Function;\n  }\n}\n\ninterface AppProps {\n  vanity?: string;\n}\n\ninterface AppState {\n  state: 'init' | 'starting' | 'connected';\n  currentMedia: string;\n  currentSubtitle: string;\n  currentMediaPaused: boolean;\n  participants: User[];\n  rosterUpdateTS: Number;\n  chat: ChatMessage[];\n  tsMap: NumberDict;\n  nameMap: StringDict;\n  pictureMap: StringDict;\n  myName: string;\n  myPicture: string;\n  loading: boolean;\n  scrollTimestamp: number;\n  fullScreen: boolean;\n  controlsTimestamp: number;\n  watchOptions: SearchResult[];\n  isScreenSharing: boolean;\n  isScreenSharingFile: boolean;\n  isVBrowser: boolean;\n  user?: firebase.User;\n  isYouTubeReady: boolean;\n  isAutoPlayable: boolean;\n  downloaded: number;\n  total: number;\n  speed: number;\n  connections: number;\n  multiStreamSelection?: any[];\n  error: string;\n  isErrorAuth: boolean;\n  settings: Settings;\n  vBrowserResolution: string;\n  isVBrowserLarge: boolean;\n  nonPlayableMedia: boolean;\n  currentTab: string;\n  isSubscriber: boolean;\n  isSubscribeModalOpen: boolean;\n  isVBrowserModalOpen: boolean;\n  roomLock: string;\n  controller?: string;\n  savedPasswords: StringDict;\n  roomId: string;\n  errorMessage: string;\n  successMessage: string;\n}\n\nexport default class App extends React.Component<AppProps, AppState> {\n  state: AppState = {\n    state: 'starting',\n    currentMedia: '',\n    currentMediaPaused: false,\n    currentSubtitle: '',\n    participants: [],\n    rosterUpdateTS: Number(new Date()),\n    chat: [],\n    tsMap: {},\n    nameMap: {},\n    pictureMap: {},\n    myName: '',\n    myPicture: '',\n    loading: true,\n    scrollTimestamp: 0,\n    fullScreen: false,\n    controlsTimestamp: 0,\n    watchOptions: [],\n    isScreenSharing: false,\n    isScreenSharingFile: false,\n    isVBrowser: false,\n    user: undefined,\n    isYouTubeReady: false,\n    isAutoPlayable: true,\n    downloaded: 0,\n    total: 0,\n    speed: 0,\n    connections: 0,\n    multiStreamSelection: undefined,\n    error: '',\n    isErrorAuth: false,\n    settings: {},\n    vBrowserResolution: '1280x720@30',\n    isVBrowserLarge: false,\n    nonPlayableMedia: false,\n    currentTab:\n      (querystring.parse(window.location.search.substring(1)).tab as string) ||\n      'chat',\n    isSubscriber: false,\n    isSubscribeModalOpen: false,\n    isVBrowserModalOpen: false,\n    roomLock: '',\n    controller: '',\n    roomId: '',\n    savedPasswords: {},\n    errorMessage: '',\n    successMessage: '',\n  };\n  socket: any = null;\n  watchPartyYTPlayer: any = null;\n  ytDebounce = true;\n  screenShareStream?: MediaStream;\n  screenHostPC: PCDict = {};\n  screenSharePC?: RTCPeerConnection;\n  progressUpdater?: number;\n\n  async componentDidMount() {\n    document.onfullscreenchange = () => {\n      this.setState({ fullScreen: Boolean(document.fullscreenElement) });\n    };\n\n    // Send heartbeat to the server\n    window.setInterval(() => {\n      window.fetch(serverPath + '/ping');\n    }, 10 * 60 * 1000);\n\n    if (firebaseConfig) {\n      firebase.auth().onAuthStateChanged(async (user: firebase.User | null) => {\n        if (user) {\n          // console.log(user);\n          this.setState({ user }, async () => {\n            this.loadSignInData();\n          });\n        }\n      });\n    }\n    this.loadSettings();\n    this.loadYouTube();\n    this.init();\n  }\n\n  loadSettings = async () => {\n    // Load settings from localstorage and remote\n    const customSettingsData = await fetch(serverPath + '/settings');\n    const customSettings = await customSettingsData.json();\n    let settings = { ...getCurrentSettings(), ...customSettings };\n    this.setState({ settings });\n  };\n\n  loadSignInData = async () => {\n    const user = this.state.user;\n    if (user && this.socket) {\n      // NOTE: firebase auth doesn't provide the actual first name data that individual providers (G/FB) do\n      // It's accessible at the time the user logs in but not afterward\n      // If we want accurate surname/given name we'll need to save that somewhere\n      const firstName = user.displayName?.split(' ')[0];\n      if (firstName) {\n        this.updateName(null, { value: firstName });\n      }\n      if (user.photoURL) {\n        this.updatePicture(user.photoURL + '?height=128&width=128');\n      }\n      this.updateUid(user);\n      const token = await user.getIdToken();\n      const response = await window.fetch(\n        serverPath + `/metadata?uid=${user.uid}&token=${token}`\n      );\n      const data = await response.json();\n      this.setState({ isSubscriber: data.isSubscriber });\n    }\n  };\n\n  loadYouTube = () => {\n    // This code loads the IFrame Player API code asynchronously.\n    const tag = document.createElement('script');\n    tag.src = 'https://www.youtube.com/iframe_api';\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag!.parentNode!.insertBefore(tag, firstScriptTag);\n\n    window.onYouTubeIframeAPIReady = () => {\n      // Note: this fails silently if the element is not available\n      const ytPlayer = new window.YT.Player('leftYt', {\n        events: {\n          onReady: () => {\n            this.watchPartyYTPlayer = ytPlayer;\n            this.setState({ isYouTubeReady: true, loading: false });\n            // We might have failed to play YT originally, ask for the current video again\n            if (this.isYouTube()) {\n              this.socket.emit('CMD:askHost');\n            }\n          },\n          onStateChange: (e: any) => {\n            if (\n              getMediaType(this.state.currentMedia) === 'youtube' &&\n              e.data === window.YT?.PlayerState?.CUED\n            ) {\n              this.setState({ loading: false });\n            }\n            // console.log(this.ytDebounce, e.data, this.watchPartyYTPlayer?.getVideoUrl());\n            if (\n              this.ytDebounce &&\n              ((e.data === window.YT?.PlayerState?.PLAYING &&\n                this.state.currentMediaPaused) ||\n                (e.data === window.YT?.PlayerState?.PAUSED &&\n                  !this.state.currentMediaPaused))\n            ) {\n              this.ytDebounce = false;\n              if (e.data === window.YT?.PlayerState?.PLAYING) {\n                this.socket.emit('CMD:play');\n                this.doPlay();\n              } else {\n                this.socket.emit('CMD:pause');\n                this.doPause();\n              }\n              window.setTimeout(() => (this.ytDebounce = true), 500);\n            }\n          },\n        },\n      });\n    };\n  };\n\n  init = async () => {\n    // Load room ID from url\n    let roomId = '/default';\n    let query = window.location.hash.substring(1);\n    if (query) {\n      roomId = '/' + query;\n    }\n    // if a vanity name, resolve the url to a room id\n    if (this.props.vanity) {\n      try {\n        const response = await axios.get(\n          serverPath + '/resolveRoom/' + this.props.vanity\n        );\n        if (response.data.roomId) {\n          roomId = response.data.roomId;\n        } else {\n          throw new Error('failed to resolve room name');\n        }\n      } catch (e) {\n        console.error(e);\n        this.setState({ error: \"There's no room with this name.\" });\n        return;\n      }\n    }\n    this.setState({ roomId });\n    this.join(roomId);\n  };\n\n  join = async (roomId: string) => {\n    let password = '';\n    try {\n      const savedPasswordsString = window.localStorage.getItem(\n        'watchparty-passwords'\n      );\n      const savedPasswords = JSON.parse(savedPasswordsString || '{}');\n      this.setState({ savedPasswords });\n      password = savedPasswords[roomId] || '';\n    } catch (e) {\n      console.warn('[ALERT] Could not parse saved passwords');\n    }\n    const socket = io.connect(serverPath + roomId, {\n      transports: ['websocket'],\n      query: {\n        clientId: getAndSaveClientId(),\n        password,\n      },\n    });\n    this.socket = socket;\n    socket.on('connect', async () => {\n      const canAutoplay = await testAutoplay();\n      this.setState({ isAutoPlayable: canAutoplay });\n      this.setState({ state: 'connected' });\n      // Load username from localstorage\n      let userName = window.localStorage.getItem('watchparty-username');\n      this.updateName(null, { value: userName || generateName() });\n      // if (!this.state.user && firebaseConfig) {\n      //   await firebase.auth().signInAnonymously();\n      // }\n      this.loadSignInData();\n    });\n    socket.on('error', (err: any) => {\n      console.error(err);\n      if (err === 'Invalid namespace') {\n        this.setState({ error: \"There's no room with this name.\" });\n      } else if (err === 'not authorized') {\n        this.setState({ isErrorAuth: true });\n      } else {\n        this.setState({ error: 'An error occurred.' });\n      }\n    });\n    socket.on('errorMessage', (err: string) => {\n      this.setState({ errorMessage: err });\n      setTimeout(() => {\n        this.setState({ errorMessage: '' });\n      }, 3000);\n    });\n    socket.on('successMessage', (success: string) => {\n      this.setState({ successMessage: success });\n      setTimeout(() => {\n        this.setState({ successMessage: '' });\n      }, 3000);\n    });\n    socket.on('REC:play', () => {\n      this.doPlay();\n    });\n    socket.on('REC:pause', () => {\n      this.doPause();\n    });\n    socket.on('REC:seek', (data: any) => {\n      this.doSeek(data);\n    });\n    socket.on('REC:subtitle', (data: string) => {\n      this.setState(\n        { currentSubtitle: serverPath + '/subtitle/' + data },\n        () => {\n          if (!this.isSubtitled()) {\n            this.toggleSubtitle();\n          }\n        }\n      );\n    });\n    socket.on('REC:changeController', (data: string) => {\n      this.setState({ controller: data });\n    });\n    socket.on('REC:host', (data: HostState) => {\n      let currentMedia = data.video || '';\n      if (this.isScreenShare() && !currentMedia.startsWith('screenshare://')) {\n        this.stopScreenShare();\n      }\n      if (this.isFileShare() && !currentMedia.startsWith('fileshare://')) {\n        this.stopScreenShare();\n      }\n      if (this.isScreenShare() && currentMedia.startsWith('screenshare://')) {\n        // Ignore, it's probably a reconnection\n        return;\n      }\n      if (this.isFileShare() && currentMedia.startsWith('fileshare://')) {\n        // Ignore, it's probably a reconnection\n        return;\n      }\n      if (this.isVBrowser() && !currentMedia.startsWith('vbrowser://')) {\n        this.stopVBrowser();\n      }\n      this.setState(\n        {\n          currentMedia,\n          currentMediaPaused: data.paused,\n          currentSubtitle: Boolean(data.subtitle)\n            ? serverPath + '/subtitle/' + data.subtitle\n            : '',\n          loading: Boolean(data.video),\n          nonPlayableMedia: false,\n          isVBrowserLarge: data.isVBrowserLarge,\n          vBrowserResolution: data.isVBrowserLarge\n            ? '1920x1080@30'\n            : '1280x720@30',\n          controller: data.controller,\n        },\n        () => {\n          if (\n            this.state.isScreenSharingFile ||\n            (this.isVBrowser() && this.getVBrowserHost())\n          ) {\n            console.log(\n              'skipping REC:host video since fileshare is using leftVideo or this is a vbrowser'\n            );\n            this.setLoadingFalse();\n            return;\n          }\n          // Stop all players\n          const leftVideo = document.getElementById(\n            'leftVideo'\n          ) as HTMLMediaElement;\n          leftVideo?.pause();\n          this.watchPartyYTPlayer?.stopVideo();\n\n          // If we can't autoplay, start muted\n          if (!this.state.isAutoPlayable) {\n            this.setMute(true);\n          }\n\n          if (this.isYouTube() && !this.watchPartyYTPlayer) {\n            console.log(\n              'YT player not ready, onReady callback will retry when it is'\n            );\n          } else if (this.isVBrowser()) {\n            console.log(\n              'not playing video as this is a vbrowser:// placeholder'\n            );\n          } else {\n            // Start this video\n            this.doSrc(data.video, data.videoTS);\n            if (!data.paused) {\n              this.doPlay();\n            }\n            if (data.subtitle) {\n              if (!this.isSubtitled()) {\n                this.toggleSubtitle();\n              }\n            }\n            // One time, when we're ready to play\n            leftVideo?.addEventListener(\n              'canplay',\n              () => {\n                this.setLoadingFalse();\n                this.jumpToLeader();\n              },\n              { once: true }\n            );\n\n            // Progress updater\n            window.clearInterval(this.progressUpdater);\n            this.setState({ downloaded: 0, total: 0, speed: 0 });\n            if (currentMedia.includes('/stream?torrent=magnet')) {\n              this.progressUpdater = window.setInterval(async () => {\n                const response = await window.fetch(\n                  currentMedia.replace('/stream', '/progress')\n                );\n                const data = await response.json();\n                this.setState({\n                  downloaded: data.downloaded,\n                  total: data.total,\n                  speed: data.speed,\n                  connections: data.connections,\n                });\n              }, 1000);\n            }\n          }\n        }\n      );\n    });\n    socket.on('REC:chat', (data: ChatMessage) => {\n      if (\n        !getCurrentSettings().disableChatSound &&\n        document.visibilityState &&\n        document.visibilityState !== 'visible'\n      ) {\n        new Audio('/clearly.mp3').play();\n      }\n      this.state.chat.push(data);\n      this.setState({\n        chat: this.state.chat,\n        scrollTimestamp: Number(new Date()),\n      });\n    });\n    socket.on('REC:tsMap', (data: NumberDict) => {\n      this.setState({ tsMap: data });\n      this.syncSubtitle();\n    });\n    socket.on('REC:nameMap', (data: StringDict) => {\n      this.setState({ nameMap: data });\n    });\n    socket.on('REC:pictureMap', (data: StringDict) => {\n      this.setState({ pictureMap: data });\n    });\n    socket.on('REC:lock', (data: string) => {\n      this.setState({ roomLock: data });\n    });\n    socket.on('roster', (data: User[]) => {\n      this.setState(\n        { participants: data, rosterUpdateTS: Number(new Date()) },\n        () => {\n          this.updateScreenShare();\n        }\n      );\n    });\n    socket.on('chatinit', (data: any) => {\n      this.setState({ chat: data, scrollTimestamp: Number(new Date()) });\n    });\n    socket.on('signalSS', async (data: any) => {\n      // Handle messages received from signaling server\n      const msg = data.msg;\n      const from = data.from;\n      // Determine whether the message came from the sharer or the sharee\n      const pc = (data.sharer\n        ? this.screenSharePC\n        : this.screenHostPC[from]) as RTCPeerConnection;\n      if (msg.ice !== undefined) {\n        pc.addIceCandidate(new RTCIceCandidate(msg.ice));\n      } else if (msg.sdp && msg.sdp.type === 'offer') {\n        // console.log('offer');\n        await pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        this.sendSignalSS(from, { sdp: pc.localDescription }, !data.sharer);\n      } else if (msg.sdp && msg.sdp.type === 'answer') {\n        pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));\n      }\n    });\n    window.setInterval(() => {\n      if (this.state.currentMedia) {\n        this.socket.emit('CMD:ts', this.getCurrentTime());\n      }\n    }, 1000);\n  };\n\n  setupFileShare = async () => {\n    const files = await openFileSelector();\n    if (!files) {\n      return;\n    }\n    const file = files[0];\n    const leftVideo = document.getElementById('leftVideo') as HTMLMediaElement;\n    leftVideo.srcObject = null;\n    leftVideo.src = URL.createObjectURL(file);\n    leftVideo.play();\n    //@ts-ignore\n    const stream = leftVideo.captureStream();\n    // Can render video to a canvas to resize it, reduce size\n    stream.onaddtrack = () => {\n      console.log(stream, stream.getVideoTracks(), stream.getAudioTracks());\n      if (\n        !this.screenShareStream &&\n        stream.getVideoTracks().length &&\n        stream.getAudioTracks().length\n      ) {\n        stream.getVideoTracks()[0].onended = this.stopScreenShare;\n        this.screenShareStream = stream;\n        this.socket.emit('CMD:joinScreenShare', { file: true });\n        this.setState({ isScreenSharing: true, isScreenSharingFile: true });\n        stream.onaddtrack = undefined;\n      }\n    };\n  };\n\n  setupScreenShare = async () => {\n    //@ts-ignore\n    const stream = await navigator.mediaDevices.getDisplayMedia({\n      video: { cursor: 'never', height: 720, logicalSurface: true },\n      audio: true,\n    });\n    stream.getVideoTracks()[0].onended = this.stopScreenShare;\n    this.screenShareStream = stream;\n    this.socket.emit('CMD:joinScreenShare');\n    this.setState({ isScreenSharing: true });\n  };\n\n  stopScreenShare = async () => {\n    this.screenShareStream &&\n      this.screenShareStream.getTracks().forEach((track) => {\n        track.stop();\n      });\n    this.screenShareStream = undefined;\n    if (this.screenSharePC) {\n      this.screenSharePC.close();\n      this.screenSharePC = undefined;\n    }\n    Object.values(this.screenHostPC).forEach((pc) => {\n      pc.close();\n    });\n    this.screenHostPC = {};\n    if (this.state.isScreenSharing) {\n      this.socket.emit('CMD:leaveScreenShare');\n    }\n    this.setState({ isScreenSharing: false, isScreenSharingFile: false });\n  };\n\n  updateScreenShare = async () => {\n    if (!this.isScreenShare() && !this.isFileShare()) {\n      return;\n    }\n    // TODO teardown for those who leave\n    const sharer = this.state.participants.find((p) => p.isScreenShare);\n    if (sharer && sharer.id === this.socket.id) {\n      // We're the sharer, create a connection to each other member\n      this.state.participants.forEach((user) => {\n        const id = user.id;\n        if (id === this.socket.id && this.state.isScreenSharingFile) {\n          // Don't set up a connection to ourselves if sharing file\n          return;\n        }\n        if (!this.screenHostPC[id]) {\n          // Set up the RTCPeerConnection for sharing media to each member\n          const pc = new RTCPeerConnection({ iceServers: iceServers() });\n          this.screenHostPC[id] = pc;\n          //@ts-ignore\n          pc.addStream(this.screenShareStream);\n          pc.onicecandidate = (event) => {\n            // We generated an ICE candidate, send it to peer\n            if (event.candidate) {\n              this.sendSignalSS(id, { ice: event.candidate }, true);\n            }\n          };\n          pc.onnegotiationneeded = async () => {\n            // Start connection for peer's video\n            const offer = await pc.createOffer();\n            await pc.setLocalDescription(offer);\n            this.sendSignalSS(id, { sdp: pc.localDescription }, true);\n          };\n        }\n      });\n    }\n    // We're a watcher, establish connection to sharer\n    // If screensharing, sharer also does this\n    // If filesharing, sharer does not do this since we use leftVideo\n    if (sharer && !this.screenSharePC && !this.state.isScreenSharingFile) {\n      const pc = new RTCPeerConnection({ iceServers: iceServers() });\n      this.screenSharePC = pc;\n      pc.onicecandidate = (event) => {\n        // We generated an ICE candidate, send it to peer\n        if (event.candidate) {\n          this.sendSignalSS(sharer.id, { ice: event.candidate });\n        }\n      };\n      //@ts-ignore\n      pc.onaddstream = (event: any) => {\n        console.log('stream from webrtc peer');\n        // Mount the stream from peer\n        const stream = event.stream;\n        // console.log(stream);\n        const leftVideo = document.getElementById(\n          'leftVideo'\n        ) as HTMLMediaElement;\n        if (leftVideo) {\n          leftVideo.src = '';\n          leftVideo.srcObject = stream;\n          if (!this.state.isAutoPlayable) {\n            this.setMute(true);\n          }\n          leftVideo.play();\n        }\n      };\n    }\n  };\n\n  setupVBrowser = async (rcToken: string, options: { size: string }) => {\n    // user.uid is the public user identifier\n    // user.getIdToken() is the secret access token we can send to the server to prove identity\n    const user = this.state.user;\n    const uid = user?.uid;\n    const token = await user?.getIdToken();\n    this.socket.emit('CMD:startVBrowser', { options, uid, token, rcToken });\n  };\n\n  stopVBrowser = async () => {\n    this.socket.emit('CMD:stopVBrowser');\n  };\n\n  changeController = async (e: any, data: DropdownProps) => {\n    // console.log(data);\n    this.socket.emit('CMD:changeController', data.value);\n  };\n\n  setSubtitle = async () => {\n    const files = await openFileSelector('.srt');\n    if (!files) {\n      return;\n    }\n    const file = files[0];\n    const reader = new FileReader();\n    reader.addEventListener('load', (event) => {\n      const subData = event.target?.result;\n      this.socket.emit('CMD:subtitle', subData);\n    });\n    reader.readAsText(file);\n  };\n\n  sendSignalSS = async (to: string, data: any, sharer?: boolean) => {\n    // console.log('sendSS', to, data);\n    this.socket.emit('signalSS', { to, msg: data, sharer });\n  };\n\n  isYouTube = () => {\n    return getMediaType(this.state.currentMedia) === 'youtube';\n  };\n\n  isVideo = () => {\n    return getMediaType(this.state.currentMedia) === 'video';\n  };\n\n  isScreenShare = () => {\n    return this.state.currentMedia.startsWith('screenshare://');\n  };\n\n  isFileShare = () => {\n    return this.state.currentMedia.startsWith('fileshare://');\n  };\n\n  isVBrowser = () => {\n    return this.state.currentMedia.startsWith('vbrowser://');\n  };\n\n  isHttp = () => {\n    return this.state.currentMedia.startsWith('http');\n  };\n\n  getVBrowserPass = () => {\n    return this.state.currentMedia.replace('vbrowser://', '').split('@')[0];\n  };\n\n  getVBrowserHost = () => {\n    return this.state.currentMedia.replace('vbrowser://', '').split('@')[1];\n  };\n\n  getCurrentTime = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo?.currentTime;\n    }\n    if (this.isYouTube()) {\n      return this.watchPartyYTPlayer?.getCurrentTime();\n    }\n  };\n\n  getDuration = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo.duration;\n    }\n    if (this.isYouTube()) {\n      return this.watchPartyYTPlayer?.getDuration();\n    }\n    return 0;\n  };\n\n  isPaused = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo.paused || leftVideo.ended;\n    }\n    if (this.isYouTube()) {\n      return (\n        this.watchPartyYTPlayer?.getPlayerState() ===\n          window.YT?.PlayerState?.PAUSED ||\n        this.watchPartyYTPlayer?.getPlayerState() ===\n          window.YT?.PlayerState?.ENDED\n      );\n    }\n    return false;\n  };\n\n  isMuted = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo?.muted;\n    }\n    if (this.isYouTube()) {\n      return this.watchPartyYTPlayer?.isMuted();\n    }\n    return false;\n  };\n\n  isSubtitled = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return (\n        leftVideo.textTracks[0] && leftVideo.textTracks[0].mode === 'showing'\n      );\n    }\n    if (this.isYouTube()) {\n      try {\n        const current = this.watchPartyYTPlayer?.getOption('captions', 'track');\n        return Boolean(current && current.languageCode);\n      } catch (e) {\n        console.warn(e);\n        return false;\n      }\n    }\n    return false;\n  };\n\n  jumpToLeader = () => {\n    // Jump to the leader's position\n    const maxTS = this.getLeaderTime();\n    if (maxTS > 0) {\n      console.log('jump to leader at ', maxTS);\n      this.doSeek(maxTS);\n    }\n  };\n\n  doSrc = async (src: string, time: number) => {\n    console.log('doSrc', src, time);\n    if (this.isScreenShare() || this.isFileShare() || this.isVBrowser()) {\n      // No-op as we'll set video when WebRTC completes\n      return;\n    }\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      if (leftVideo) {\n        leftVideo.srcObject = null;\n        leftVideo.src = src;\n        leftVideo.currentTime = time;\n        // Clear subtitles\n        leftVideo.innerHTML = '';\n      }\n    }\n    if (this.isYouTube()) {\n      let url = new window.URL(src);\n      // Standard link https://www.youtube.com/watch?v=ID\n      let videoId = querystring.parse(url.search.substring(1))['v'];\n      // Link shortener https://youtu.be/ID\n      let altVideoId = src.split('/').slice(-1)[0];\n      this.watchPartyYTPlayer?.cueVideoById(videoId || altVideoId, time);\n    }\n  };\n\n  doPlay = async () => {\n    this.setState({ currentMediaPaused: false }, async () => {\n      if (this.isVideo()) {\n        const leftVideo = document.getElementById(\n          'leftVideo'\n        ) as HTMLMediaElement;\n        try {\n          await leftVideo?.play();\n        } catch (e) {\n          // console.warn(e);\n          console.warn(e.name);\n          if (e.name === 'NotSupportedError') {\n            this.setState({ loading: false, nonPlayableMedia: true });\n          }\n        }\n      }\n      if (this.isYouTube()) {\n        console.log('play yt');\n        this.watchPartyYTPlayer?.playVideo();\n      }\n    });\n  };\n\n  doPause = () => {\n    this.setState({ currentMediaPaused: true }, async () => {\n      if (this.isVideo()) {\n        const leftVideo = document.getElementById(\n          'leftVideo'\n        ) as HTMLMediaElement;\n        leftVideo.pause();\n      }\n      if (this.isYouTube()) {\n        console.log('pause');\n        this.watchPartyYTPlayer?.pauseVideo();\n      }\n    });\n  };\n\n  doSeek = (time: number) => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      leftVideo.currentTime = time;\n    }\n    if (this.isYouTube()) {\n      this.watchPartyYTPlayer?.seekTo(time, true);\n    }\n  };\n\n  togglePlay = () => {\n    let shouldPlay = true;\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      shouldPlay = leftVideo.paused || leftVideo.ended;\n    } else if (this.isYouTube()) {\n      shouldPlay =\n        this.watchPartyYTPlayer?.getPlayerState() ===\n          window.YT?.PlayerState.PAUSED ||\n        this.getCurrentTime() === this.getDuration();\n    }\n    if (shouldPlay) {\n      this.socket.emit('CMD:play');\n      this.doPlay();\n    } else {\n      this.socket.emit('CMD:pause');\n      this.doPause();\n    }\n  };\n\n  onSeek = (e: any, time: number) => {\n    let target = time;\n    if (e) {\n      const rect = e.target.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const max = rect.width;\n      target = (x / max) * this.getDuration();\n    }\n    target = Math.max(target, 0);\n    this.doSeek(target);\n    this.socket.emit('CMD:seek', target);\n  };\n\n  onVideoKeydown = (e: any) => {\n    if (e.key === ' ') {\n      e.preventDefault();\n      this.togglePlay();\n    } else if (e.key === 'ArrowRight') {\n      this.onSeek(null, this.getCurrentTime() + 10);\n    } else if (e.key === 'ArrowLeft') {\n      this.onSeek(null, this.getCurrentTime() - 10);\n    } else if (e.key === 'c') {\n      this.toggleSubtitle();\n    } else if (e.key === 't') {\n      this.fullScreen(false);\n    } else if (e.key === 'f') {\n      this.fullScreen(true);\n    } else if (e.key === 'm') {\n      this.toggleMute();\n    }\n  };\n\n  fullScreen = async (bVideoOnly: boolean) => {\n    let container = document.getElementById(\n      'fullScreenContainer'\n    ) as HTMLElement;\n    if (bVideoOnly || isMobile()) {\n      container = document.getElementById(\n        this.isYouTube() ? 'leftYt' : 'leftVideo'\n      ) as HTMLElement;\n    }\n    if (!document.fullscreenElement) {\n      await container.requestFullscreen();\n      return;\n    }\n    const bChangeElements = document.fullscreenElement !== container;\n    await document.exitFullscreen();\n    if (bChangeElements) {\n      await container.requestFullscreen();\n    }\n  };\n\n  toggleMute = () => {\n    this.setMute(!this.isMuted());\n  };\n\n  setMute = (muted: boolean) => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      if (leftVideo) {\n        leftVideo.muted = muted;\n      }\n    }\n    if (this.isYouTube()) {\n      if (muted) {\n        this.watchPartyYTPlayer?.mute();\n      } else {\n        this.watchPartyYTPlayer?.unMute();\n      }\n    }\n  };\n\n  setVolume = (volume: number) => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      leftVideo.volume = volume;\n    }\n    if (this.isYouTube()) {\n      this.watchPartyYTPlayer?.setVolume(volume * 100);\n    }\n  };\n\n  getVolume = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo.volume;\n    }\n    if (this.isYouTube()) {\n      const volume = this.watchPartyYTPlayer?.getVolume();\n      return volume / 100;\n    }\n  };\n\n  loadSubtitles = async () => {\n    const leftVideo = document.getElementById('leftVideo') as HTMLMediaElement;\n    // Clear subtitles\n    leftVideo.innerHTML = '';\n    let subtitleSrc = '';\n    const src = this.state.currentMedia;\n    if (this.state.currentSubtitle) {\n      subtitleSrc = this.state.currentSubtitle;\n    } else if (src.includes('/stream?torrent=magnet')) {\n      subtitleSrc = src.replace('/stream', '/subtitles2');\n    } else if (src.startsWith('http')) {\n      const subtitlePath = src.slice(0, src.lastIndexOf('/') + 1);\n      // Expect subtitle name to be file name + .srt\n      subtitleSrc =\n        subtitlePath + 'subtitles/' + this.getFileName(src) + '.srt';\n    }\n    if (subtitleSrc) {\n      const response = await window.fetch(subtitleSrc);\n      const buffer = await response.arrayBuffer();\n      const vttConverter = new VTTConverter(new Blob([buffer]));\n      const url = await vttConverter.getURL();\n      const track = document.createElement('track');\n      track.kind = 'captions';\n      track.label = 'English';\n      track.srclang = 'en';\n      track.src = url;\n      leftVideo.appendChild(track);\n      leftVideo.textTracks[0].mode = 'showing';\n    }\n  };\n\n  syncSubtitle = () => {\n    const sharer = this.state.participants.find((p) => p.isScreenShare);\n    if (!sharer || sharer.id === this.socket.id) {\n      return;\n    }\n    // When sharing, our timestamp doesn't match the subtitles so adjust them\n    // For each cue, subtract the videoTS of the sharer, then add our own\n    const leftVideo = document.getElementById('leftVideo') as HTMLMediaElement;\n    const track = leftVideo?.textTracks[0];\n    let offset = leftVideo.currentTime - this.state.tsMap[sharer.id];\n    if (track && offset && track.cues) {\n      for (let i = 0; i < track.cues.length; i++) {\n        let cue = track.cues[i];\n        // console.log(cue.text, offset, (cue as any).origStart, (cue as any).origEnd);\n        if (!(cue as any).origStart) {\n          (cue as any).origStart = cue.startTime;\n          (cue as any).origEnd = cue.endTime;\n        }\n        cue.startTime = (cue as any).origStart + offset;\n        cue.endTime = (cue as any).origEnd + offset;\n      }\n    }\n  };\n\n  toggleSubtitle = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      if (this.isSubtitled()) {\n        leftVideo.innerHTML = '';\n      } else {\n        this.loadSubtitles();\n      }\n    }\n    if (this.isYouTube()) {\n      const isSubtitled = this.isSubtitled();\n      // console.log(isSubtitled);\n      if (isSubtitled) {\n        // BUG this doesn't actually set the value so subtitles can't be toggled off\n        this.watchPartyYTPlayer?.setOption('captions', 'track', {});\n      } else {\n        this.watchPartyYTPlayer?.setOption('captions', 'reload', true);\n        const tracks = this.watchPartyYTPlayer?.getOption(\n          'captions',\n          'tracklist'\n        );\n        this.watchPartyYTPlayer?.setOption('captions', 'track', tracks[0]);\n      }\n    }\n  };\n\n  setMedia = (e: any, data: DropdownProps) => {\n    this.socket.emit('CMD:host', data.value);\n  };\n\n  launchMultiSelect = (data: any) => {\n    this.setState({ multiStreamSelection: data });\n  };\n\n  resetMultiSelect = () => {\n    this.setState({ multiStreamSelection: undefined });\n  };\n\n  updateName = (e: any, data: { value: string }) => {\n    this.setState({ myName: data.value });\n    this.socket.emit('CMD:name', data.value);\n    window.localStorage.setItem('watchparty-username', data.value);\n  };\n\n  updatePicture = (url: string) => {\n    this.setState({ myPicture: url });\n    this.socket.emit('CMD:picture', url);\n  };\n\n  updateUid = async (user: firebase.User) => {\n    const uid = user.uid;\n    const token = await user.getIdToken();\n    this.socket.emit('CMD:uid', { uid, token });\n  };\n\n  getMediaDisplayName = (input: string) => {\n    if (!input) {\n      return '';\n    }\n    // Show the whole URL for youtube\n    if (getMediaType(input) === 'youtube') {\n      return input;\n    }\n    if (input.startsWith('screenshare://')) {\n      let id = input.slice('screenshare://'.length);\n      return this.state.nameMap[id] + \"'s screen\";\n    }\n    if (input.startsWith('fileshare://')) {\n      let id = input.slice('fileshare://'.length);\n      return this.state.nameMap[id] + \"'s file\";\n    }\n    if (input.startsWith('vbrowser://')) {\n      return 'Virtual Browser' + (this.state.isVBrowserLarge ? '+' : '');\n    }\n    if (input.includes('/stream?torrent=magnet')) {\n      const search = new URL(input).search;\n      const magnetUrl = querystring.parse(search.substring(1)).torrent;\n      const magnetParsed = magnet.decode(magnetUrl);\n      return magnetParsed.name;\n    }\n    // Get the filename out of the URL\n    return input;\n  };\n\n  getFileName = (input: string) => {\n    return input.split('/').slice(-1)[0];\n  };\n\n  setLoadingFalse = () => {\n    this.setState({ loading: false });\n  };\n\n  onManage = async () => {\n    const resp = await window.fetch(serverPath + '/manageSub', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        uid: this.state.user?.uid,\n        token: await this.state.user?.getIdToken(),\n        return_url: window.location.href,\n      }),\n    });\n    const session = await resp.json();\n    console.log(session);\n    window.location.assign(session.url);\n  };\n\n  setRoomLock = async (locked: boolean) => {\n    const uid = this.state.user?.uid;\n    const token = await this.state.user?.getIdToken();\n    this.socket.emit('CMD:lock', { uid, token, locked });\n  };\n\n  haveLock = () => {\n    if (!this.state.roomLock) {\n      return true;\n    }\n    return this.state.user?.uid === this.state.roomLock;\n  };\n\n  getLeaderTime = () => {\n    return Math.max(...Object.values(this.state.tsMap));\n  };\n\n  render() {\n    const sharer = this.state.participants.find((p) => p.isScreenShare);\n    const controls = (\n      <Controls\n        key={this.state.controlsTimestamp}\n        togglePlay={this.togglePlay}\n        onSeek={this.onSeek}\n        fullScreen={this.fullScreen}\n        toggleMute={this.toggleMute}\n        toggleSubtitle={this.toggleSubtitle}\n        setVolume={this.setVolume}\n        getVolume={this.getVolume}\n        jumpToLeader={this.jumpToLeader}\n        paused={this.isPaused()}\n        muted={this.isMuted()}\n        subtitled={this.isSubtitled()}\n        currentTime={this.getCurrentTime()}\n        duration={this.getDuration()}\n        disabled={!this.haveLock()}\n        leaderTime={this.isHttp() ? this.getLeaderTime() : undefined}\n      />\n    );\n    return (\n      <React.Fragment>\n        {this.state.multiStreamSelection && (\n          <MultiStreamModal\n            streams={this.state.multiStreamSelection}\n            setMedia={this.setMedia}\n            resetMultiSelect={this.resetMultiSelect}\n          />\n        )}\n        {this.state.isSubscribeModalOpen && (\n          <SubscribeModal\n            user={this.state.user}\n            isSubscriber={this.state.isSubscriber}\n            closeSubscribe={() =>\n              this.setState({ isSubscribeModalOpen: false })\n            }\n          />\n        )}\n        {this.state.isVBrowserModalOpen && (\n          <VBrowserModal\n            isSubscriber={this.state.isSubscriber}\n            closeModal={() => this.setState({ isVBrowserModalOpen: false })}\n            openSubscribe={() => this.setState({ isSubscribeModalOpen: true })}\n            startVBrowser={this.setupVBrowser}\n          />\n        )}\n        {this.state.error && <ErrorModal error={this.state.error} />}\n        {this.state.isErrorAuth && (\n          <PasswordModal\n            savedPasswords={this.state.savedPasswords}\n            roomId={this.state.roomId}\n          />\n        )}\n        {this.state.errorMessage && (\n          <Message\n            negative\n            header=\"Error\"\n            content={this.state.errorMessage}\n            style={{ position: 'fixed', bottom: '10px', right: '10px' }}\n          ></Message>\n        )}\n        {this.state.successMessage && (\n          <Message\n            positive\n            header=\"Success\"\n            content={this.state.successMessage}\n            style={{ position: 'fixed', bottom: '10px', right: '10px' }}\n          ></Message>\n        )}\n        {!this.state.error && !this.state.isAutoPlayable && (\n          <Modal inverted basic open>\n            <div style={{ display: 'flex', justifyContent: 'center' }}>\n              <Button\n                primary\n                size=\"huge\"\n                onClick={() => {\n                  this.setState({ isAutoPlayable: true });\n                  this.setMute(false);\n                }}\n                icon\n                labelPosition=\"left\"\n              >\n                <Icon name=\"sign-in\" />\n                Join Party\n              </Button>\n            </div>\n          </Modal>\n        )}\n        <TopBar user={this.state.user} />\n        {\n          <Grid stackable celled=\"internally\">\n            <Grid.Row>\n              <Grid.Column width={12} className=\"fullHeightColumn\">\n                <div\n                  style={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    height: '100%',\n                  }}\n                >\n                  <ComboBox\n                    setMedia={this.setMedia}\n                    currentMedia={this.state.currentMedia}\n                    getMediaDisplayName={this.getMediaDisplayName}\n                    launchMultiSelect={this.launchMultiSelect}\n                    streamPath={this.state.settings.streamPath}\n                    mediaPath={this.state.settings.mediaPath}\n                    disabled={!this.haveLock()}\n                  />\n                  <Separator />\n                  <div className=\"mobileStack\" style={{ display: 'flex' }}>\n                    {this.screenShareStream && (\n                      <Button\n                        fluid\n                        className=\"toolButton\"\n                        icon\n                        labelPosition=\"left\"\n                        color=\"red\"\n                        onClick={this.stopScreenShare}\n                        disabled={sharer?.id !== this.socket?.id}\n                      >\n                        <Icon name=\"cancel\" />\n                        Stop Share\n                      </Button>\n                    )}\n                    {!this.screenShareStream && !sharer && !this.isVBrowser() && (\n                      <Popup\n                        content={`Share a tab or an application. Make sure to check \"Share audio\" for best results.`}\n                        trigger={\n                          <Button\n                            fluid\n                            className=\"toolButton\"\n                            disabled={!this.haveLock()}\n                            icon\n                            labelPosition=\"left\"\n                            color={'instagram'}\n                            onClick={this.setupScreenShare}\n                          >\n                            <Icon name={'slideshare'} />\n                            Screenshare\n                          </Button>\n                        }\n                      />\n                    )}\n                    {!this.screenShareStream && !sharer && !this.isVBrowser() && (\n                      <Popup\n                        content=\"Launch a shared virtual browser\"\n                        trigger={\n                          <Button\n                            fluid\n                            className=\"toolButton\"\n                            disabled={!this.haveLock()}\n                            icon\n                            labelPosition=\"left\"\n                            color=\"green\"\n                            onClick={() => {\n                              this.setState({ isVBrowserModalOpen: true });\n                            }}\n                          >\n                            <Icon name=\"desktop\" />\n                            VBrowser\n                          </Button>\n                        }\n                      />\n                    )}\n                    {this.isVBrowser() && (\n                      <Popup\n                        content=\"Choose the person controlling the VBrowser\"\n                        trigger={\n                          <Dropdown\n                            icon=\"keyboard\"\n                            labeled\n                            className=\"icon\"\n                            style={{ height: '36px' }}\n                            button\n                            value={this.state.controller}\n                            placeholder=\"No controller\"\n                            onChange={this.changeController}\n                            selection\n                            disabled={!this.haveLock()}\n                            options={this.state.participants.map((p) => ({\n                              text: this.state.nameMap[p.id] || p.id,\n                              value: p.id,\n                            }))}\n                          ></Dropdown>\n                        }\n                      />\n                    )}\n                    {this.isVBrowser() && (\n                      <Dropdown\n                        icon=\"desktop\"\n                        labeled\n                        className=\"icon\"\n                        style={{ height: '36px' }}\n                        button\n                        disabled={!this.haveLock()}\n                        value={this.state.vBrowserResolution}\n                        onChange={(e, data) =>\n                          this.setState({\n                            vBrowserResolution: data.value as string,\n                          })\n                        }\n                        selection\n                        options={[\n                          {\n                            text: '1080p',\n                            value: '1920x1080@30',\n                            disabled: !this.state.isVBrowserLarge,\n                          },\n                          {\n                            text: '720p',\n                            value: '1280x720@30',\n                          },\n                          {\n                            text: '576p',\n                            value: '1024x576@60',\n                          },\n                          {\n                            text: '486p',\n                            value: '864x486@60',\n                          },\n                          {\n                            text: '360p',\n                            value: '640x360@60',\n                          },\n                        ]}\n                      ></Dropdown>\n                    )}\n                    {this.isVBrowser() && (\n                      <Button\n                        fluid\n                        className=\"toolButton\"\n                        icon\n                        labelPosition=\"left\"\n                        color=\"red\"\n                        disabled={!this.haveLock()}\n                        onClick={this.stopVBrowser}\n                      >\n                        <Icon name=\"cancel\" />\n                        Stop VBrowser\n                      </Button>\n                    )}\n                    {!this.screenShareStream && !sharer && !this.isVBrowser() && (\n                      <Popup\n                        content=\"Stream your own video file\"\n                        trigger={\n                          <Button\n                            fluid\n                            className=\"toolButton\"\n                            disabled={!this.haveLock()}\n                            icon\n                            labelPosition=\"left\"\n                            onClick={this.setupFileShare}\n                          >\n                            <Icon name=\"file\" />\n                            File\n                          </Button>\n                        }\n                      />\n                    )}\n                    {false && (\n                      <SearchComponent\n                        setMedia={this.setMedia}\n                        type={'youtube'}\n                        streamPath={this.state.settings.streamPath}\n                        mediaPath={this.state.settings.mediaPath}\n                        disabled={!this.haveLock()}\n                      />\n                    )}\n                    {Boolean(this.state.settings.mediaPath) && (\n                      <SearchComponent\n                        setMedia={this.setMedia}\n                        type={'media'}\n                        streamPath={this.state.settings.streamPath}\n                        mediaPath={this.state.settings.mediaPath}\n                        disabled={!this.haveLock()}\n                      />\n                    )}\n                    {Boolean(this.state.settings.streamPath) && (\n                      <SearchComponent\n                        setMedia={this.setMedia}\n                        type={'stream'}\n                        streamPath={this.state.settings.streamPath}\n                        mediaPath={this.state.settings.mediaPath}\n                        launchMultiSelect={this.launchMultiSelect}\n                        disabled={!this.haveLock()}\n                      />\n                    )}\n                    {this.state.currentMedia && (\n                      <Popup\n                        content=\"Upload a .srt subtitle file for this video\"\n                        trigger={\n                          <Button\n                            fluid\n                            color=\"violet\"\n                            className=\"toolButton\"\n                            icon\n                            labelPosition=\"left\"\n                            onClick={this.setSubtitle}\n                            disabled={!this.haveLock()}\n                          >\n                            <Icon name=\"closed captioning\" />\n                            Subtitle\n                          </Button>\n                        }\n                      />\n                    )}\n                    {!this.state.isSubscriber && (\n                      <Popup\n                        content=\"Subscribe to help support us and enable additional features!\"\n                        trigger={\n                          <Button\n                            fluid\n                            color=\"orange\"\n                            className=\"toolButton\"\n                            icon\n                            labelPosition=\"left\"\n                            onClick={() =>\n                              this.setState({ isSubscribeModalOpen: true })\n                            }\n                          >\n                            <Icon name=\"plus\" />\n                            Subscribe\n                          </Button>\n                        }\n                      />\n                    )}\n                    {this.state.isSubscriber && (\n                      <Popup\n                        content=\"Manage your subscription\"\n                        trigger={\n                          <Button\n                            fluid\n                            color=\"orange\"\n                            className=\"toolButton\"\n                            icon\n                            labelPosition=\"left\"\n                            onClick={this.onManage}\n                          >\n                            <Icon name=\"wrench\" />\n                            Manage\n                          </Button>\n                        }\n                      />\n                    )}\n                  </div>\n                  <Separator />\n                  <div\n                    id=\"fullScreenContainer\"\n                    className={\n                      this.state.fullScreen ? 'fullScreenContainer' : ''\n                    }\n                    style={{ flexGrow: 1 }}\n                  >\n                    <div\n                      id=\"playerContainer\"\n                      tabIndex={1}\n                      onKeyDown={this.onVideoKeydown}\n                    >\n                      {(this.state.loading ||\n                        !this.state.currentMedia ||\n                        this.state.nonPlayableMedia) && (\n                        <div\n                          id=\"loader\"\n                          className=\"videoContent\"\n                          style={{\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                          }}\n                        >\n                          {this.state.loading && (\n                            <Dimmer active>\n                              <Loader>\n                                {this.isVBrowser()\n                                  ? 'Launching virtual browser. This can take up to a minute.'\n                                  : ''}\n                              </Loader>\n                            </Dimmer>\n                          )}\n                          {!this.state.loading && !this.state.currentMedia && (\n                            <Message\n                              color=\"yellow\"\n                              icon=\"hand point up\"\n                              header=\"You're not watching anything!\"\n                              content=\"Pick something to watch above.\"\n                            />\n                          )}\n                          {!this.state.loading &&\n                            this.state.nonPlayableMedia && (\n                              <Message\n                                color=\"red\"\n                                icon=\"frown\"\n                                header=\"It doesn't look like this is a media file!\"\n                                content=\"Maybe you meant to launch a VBrowser if you're trying to visit a web page?\"\n                              />\n                            )}\n                        </div>\n                      )}\n                      <iframe\n                        style={{\n                          display:\n                            this.isYouTube() && !this.state.loading\n                              ? 'block'\n                              : 'none',\n                        }}\n                        title=\"YouTube\"\n                        id=\"leftYt\"\n                        className=\"videoContent\"\n                        allowFullScreen\n                        frameBorder=\"0\"\n                        allow=\"autoplay\"\n                        src=\"https://www.youtube.com/embed/?enablejsapi=1&controls=0&rel=0\"\n                      />\n                      {this.isVBrowser() &&\n                      this.getVBrowserPass() &&\n                      this.getVBrowserHost() ? (\n                        <VBrowser\n                          username={this.socket.id}\n                          password={this.getVBrowserPass()}\n                          hostname={this.getVBrowserHost()}\n                          controlling={this.state.controller === this.socket.id}\n                          setLoadingFalse={this.setLoadingFalse}\n                          resolution={this.state.vBrowserResolution}\n                          isAutoPlayable={this.state.isAutoPlayable}\n                          setResolution={(data: string) =>\n                            this.setState({ vBrowserResolution: data })\n                          }\n                        />\n                      ) : (\n                        <video\n                          style={{\n                            display:\n                              this.isVideo() && !this.state.loading\n                                ? 'block'\n                                : 'none',\n                            width: '100%',\n                          }}\n                          id=\"leftVideo\"\n                        ></video>\n                      )}\n                      {this.state.fullScreen && this.state.currentMedia && (\n                        <div className=\"controlsContainer\">{controls}</div>\n                      )}\n                    </div>\n                    {this.state.fullScreen && (\n                      <Chat\n                        className=\"fullScreenChat\"\n                        chat={this.state.chat}\n                        nameMap={this.state.nameMap}\n                        pictureMap={this.state.pictureMap}\n                        socket={this.socket}\n                        scrollTimestamp={this.state.scrollTimestamp}\n                        getMediaDisplayName={this.getMediaDisplayName}\n                      />\n                    )}\n                  </div>\n                  {this.state.currentMedia && controls}\n                  {Boolean(this.state.total) && (\n                    <div>\n                      <Progress\n                        size=\"tiny\"\n                        color=\"green\"\n                        inverted\n                        value={this.state.downloaded}\n                        total={this.state.total}\n                        // indicating\n                        label={\n                          Math.min(\n                            (this.state.downloaded / this.state.total) * 100,\n                            100\n                          ).toFixed(2) +\n                          '% - ' +\n                          formatSpeed(this.state.speed) +\n                          ' - ' +\n                          this.state.connections +\n                          ' connections'\n                        }\n                      ></Progress>\n                    </div>\n                  )}\n                </div>\n              </Grid.Column>\n              <Grid.Column\n                width={4}\n                style={{ display: 'flex', flexDirection: 'column' }}\n                className=\"fullHeightColumn\"\n              >\n                <Input\n                  inverted\n                  fluid\n                  label={'Name:'}\n                  value={this.state.myName}\n                  onChange={this.updateName}\n                  icon={\n                    <Icon\n                      onClick={() =>\n                        this.updateName(null, { value: generateName() })\n                      }\n                      name=\"refresh\"\n                      inverted\n                      circular\n                      link\n                    />\n                  }\n                />\n                {/* <Divider inverted horizontal></Divider> */}\n                {!this.state.fullScreen && (\n                  <Menu\n                    inverted\n                    widths={3}\n                    style={{ marginTop: '4px', marginBottom: '4px' }}\n                  >\n                    <Menu.Item\n                      name=\"chat\"\n                      active={this.state.currentTab === 'chat'}\n                      onClick={() => this.setState({ currentTab: 'chat' })}\n                      as=\"a\"\n                    >\n                      {/* <Icon name=\"conversation\" /> */}\n                      Chat\n                    </Menu.Item>\n                    <Menu.Item\n                      name=\"people\"\n                      active={this.state.currentTab === 'people'}\n                      onClick={() => this.setState({ currentTab: 'people' })}\n                      as=\"a\"\n                    >\n                      {/* <Icon name=\"group\" /> */}\n                      Webcam ({this.state.participants.length})\n                    </Menu.Item>\n                  </Menu>\n                )}\n                <Chat\n                  chat={this.state.chat}\n                  nameMap={this.state.nameMap}\n                  pictureMap={this.state.pictureMap}\n                  socket={this.socket}\n                  scrollTimestamp={this.state.scrollTimestamp}\n                  getMediaDisplayName={this.getMediaDisplayName}\n                  hide={this.state.currentTab !== 'chat'}\n                />\n                {this.state.state === 'connected' && (\n                  <VideoChat\n                    socket={this.socket}\n                    participants={this.state.participants}\n                    nameMap={this.state.nameMap}\n                    pictureMap={this.state.pictureMap}\n                    tsMap={this.state.tsMap}\n                    rosterUpdateTS={this.state.rosterUpdateTS}\n                    hide={this.state.currentTab !== 'people'}\n                  />\n                )}\n                <SettingsTab\n                  hide={this.state.currentTab !== 'settings'}\n                  user={this.state.user}\n                  roomLock={this.state.roomLock}\n                  setRoomLock={this.setRoomLock}\n                  socket={this.socket}\n                  isSubscriber={this.state.isSubscriber}\n                  roomId={this.state.roomId}\n                />\n              </Grid.Column>\n            </Grid.Row>\n          </Grid>\n        }\n      </React.Fragment>\n    );\n  }\n}\n\nexport const Separator = () => <div style={{ height: '4px', flexShrink: 0 }} />;\n"]},"metadata":{},"sourceType":"module"}