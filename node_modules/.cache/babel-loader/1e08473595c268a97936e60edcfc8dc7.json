{"ast":null,"code":"import _classCallCheck from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Button,Comment,Icon,Input}from'semantic-ui-react';import'emoji-mart/css/emoji-mart.css';import{Picker}from'emoji-mart';import onClickOutside from'react-onclickoutside';import{formatTimestamp,getColorHex,getDefaultPicture}from'../../utils';import{Separator}from'../App/App';export var Chat=/*#__PURE__*/function(_React$Component){_inherits(Chat,_React$Component);var _super=_createSuper(Chat);function Chat(){var _this;_classCallCheck(this,Chat);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={chatMsg:'',isNearBottom:true,isPickerOpen:false};_this.messagesRef=React.createRef();_this.updateChatMsg=function(e,data){// console.log(e.target.selectionStart);\n_this.setState({chatMsg:data.value});};_this.sendChatMsg=function(){if(!_this.state.chatMsg){return;}if(_this.chatTooLong()){return;}_this.setState({chatMsg:''});_this.props.socket.emit('CMD:chat',_this.state.chatMsg);};_this.chatTooLong=function(){var _this$state$chatMsg;return Boolean(((_this$state$chatMsg=_this.state.chatMsg)===null||_this$state$chatMsg===void 0?void 0:_this$state$chatMsg.length)>10000);};_this.onScroll=function(){_this.setState({isNearBottom:_this.isChatNearBottom()});};_this.isChatNearBottom=function(){return _this.messagesRef.current&&_this.messagesRef.current.scrollHeight-_this.messagesRef.current.scrollTop-_this.messagesRef.current.offsetHeight<100;};_this.scrollToBottom=function(){if(_this.messagesRef.current){_this.messagesRef.current.scrollTop=_this.messagesRef.current.scrollHeight;}};_this.formatMessage=function(cmd,msg){if(cmd==='host'){return/*#__PURE__*/React.createElement(React.Fragment,null,\"changed the video to \",/*#__PURE__*/React.createElement(\"span\",{style:{textTransform:'initial'}},_this.props.getMediaDisplayName(msg)));}else if(cmd==='seek'){return\"jumped to \".concat(formatTimestamp(msg));}else if(cmd==='play'){return\"started the video at \".concat(formatTimestamp(msg));}else if(cmd==='pause'){return\"paused the video at \".concat(formatTimestamp(msg));}else if(cmd==='lock'){return\"locked the room\";}else if(cmd==='unlock'){return'unlocked the room';}else if(cmd==='vBrowserTimeout'){return/*#__PURE__*/React.createElement(React.Fragment,null,\"The VBrowser shut down automatically.\",/*#__PURE__*/React.createElement(\"br\",null),\"Subscribe for sessions up to 12 hours.\");}else if(cmd==='vBrowserAlmostTimeout'){return/*#__PURE__*/React.createElement(React.Fragment,null,\"The VBrowser will shut down soon.\",/*#__PURE__*/React.createElement(\"br\",null),\"Subscribe for sessions up to 12 hours.\");}return cmd;};_this.addEmoji=function(emoji){_this.setState({chatMsg:_this.state.chatMsg+emoji.native});};return _this;}_createClass(Chat,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$messagesRef$cur;this.scrollToBottom();(_this$messagesRef$cur=this.messagesRef.current)===null||_this$messagesRef$cur===void 0?void 0:_this$messagesRef$cur.addEventListener('scroll',this.onScroll);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.scrollTimestamp!==prevProps.scrollTimestamp){if(prevProps.scrollTimestamp===0||this.state.isNearBottom){this.scrollToBottom();}}if(this.props.hide!==prevProps.hide){this.scrollToBottom();}}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",{className:this.props.className,style:{display:this.props.hide?'none':'flex',flexDirection:'column',flexGrow:1,minHeight:0,marginTop:0,marginBottom:0,padding:'8px'}},/*#__PURE__*/React.createElement(\"div\",{className:\"chatContainer\",ref:this.messagesRef,style:{position:'relative'}},/*#__PURE__*/React.createElement(Comment.Group,null,this.props.chat.map(function(msg){return/*#__PURE__*/React.createElement(ChatMessage,{key:msg.timestamp+msg.id,message:msg,pictureMap:_this2.props.pictureMap,nameMap:_this2.props.nameMap,formatMessage:_this2.formatMessage});})),!this.state.isNearBottom&&/*#__PURE__*/React.createElement(Button,{size:\"tiny\",onClick:this.scrollToBottom,style:{position:'sticky',bottom:0,display:'block',margin:'0 auto'}},\"Jump to bottom\")),/*#__PURE__*/React.createElement(Separator,null),this.state.isPickerOpen&&/*#__PURE__*/React.createElement(PickerMenu,{addEmoji:this.addEmoji,closeMenu:function closeMenu(){return _this2.setState({isPickerOpen:false});}}),/*#__PURE__*/React.createElement(Input,{inverted:true,fluid:true,onKeyPress:function onKeyPress(e){return e.key==='Enter'&&_this2.sendChatMsg();},onChange:this.updateChatMsg,value:this.state.chatMsg,error:this.chatTooLong(),icon:true,placeholder:\"Enter a message...\"},/*#__PURE__*/React.createElement(\"input\",null),/*#__PURE__*/React.createElement(Icon// style={{ right: '40px' }}\n,{onClick:function onClick(){return _this2.setState({isPickerOpen:true});},name:'',inverted:true,circular:true,link:true,style:{opacity:1}},/*#__PURE__*/React.createElement(\"span\",{role:\"img\",\"aria-label\":\"Emoji\"},\"\\uD83D\\uDE00\"))));}}]);return Chat;}(React.Component);var ChatMessage=function ChatMessage(_ref){var message=_ref.message,nameMap=_ref.nameMap,pictureMap=_ref.pictureMap,formatMessage=_ref.formatMessage;var id=message.id,timestamp=message.timestamp,cmd=message.cmd,msg=message.msg,system=message.system;return/*#__PURE__*/React.createElement(Comment,null,id?/*#__PURE__*/React.createElement(Comment.Avatar,{src:pictureMap[id]||getDefaultPicture(nameMap[id],getColorHex(id))}):null,/*#__PURE__*/React.createElement(Comment.Content,null,/*#__PURE__*/React.createElement(Comment.Author,{as:\"a\",className:\"light\"},Boolean(system)&&'System',nameMap[id]||id),/*#__PURE__*/React.createElement(Comment.Metadata,{className:\"dark\"},/*#__PURE__*/React.createElement(\"div\",null,new Date(timestamp).toLocaleTimeString())),/*#__PURE__*/React.createElement(Comment.Text,{className:\"light system\"},cmd&&formatMessage(cmd,msg)),/*#__PURE__*/React.createElement(Comment.Text,{className:\"light\"},!cmd&&msg)));};var PickerMenuInner=/*#__PURE__*/function(_React$Component2){_inherits(PickerMenuInner,_React$Component2);var _super2=_createSuper(PickerMenuInner);function PickerMenuInner(){var _this3;_classCallCheck(this,PickerMenuInner);for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}_this3=_super2.call.apply(_super2,[this].concat(args));_this3.handleClickOutside=function(){_this3.props.closeMenu();};return _this3;}_createClass(PickerMenuInner,[{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{style:{position:'absolute',bottom:'60px'}},/*#__PURE__*/React.createElement(Picker,{set:\"google\",sheetSize:64,theme:\"dark\",showPreview:false,showSkinTones:false,onSelect:this.props.addEmoji}));}}]);return PickerMenuInner;}(React.Component);var PickerMenu=onClickOutside(PickerMenuInner);","map":{"version":3,"sources":["/Users/tinvotan/Projects/fayrtv/fayr_test/fayrtv_test/src/components/Chat/Chat.tsx"],"names":["React","Button","Comment","Icon","Input","Picker","onClickOutside","formatTimestamp","getColorHex","getDefaultPicture","Separator","Chat","state","chatMsg","isNearBottom","isPickerOpen","messagesRef","createRef","updateChatMsg","e","data","setState","value","sendChatMsg","chatTooLong","props","socket","emit","Boolean","length","onScroll","isChatNearBottom","current","scrollHeight","scrollTop","offsetHeight","scrollToBottom","formatMessage","cmd","msg","textTransform","getMediaDisplayName","addEmoji","emoji","native","addEventListener","prevProps","scrollTimestamp","hide","className","display","flexDirection","flexGrow","minHeight","marginTop","marginBottom","padding","position","chat","map","timestamp","id","pictureMap","nameMap","bottom","margin","key","opacity","Component","ChatMessage","message","system","Date","toLocaleTimeString","PickerMenuInner","handleClickOutside","closeMenu","PickerMenu"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Button, Comment, Icon, Input } from 'semantic-ui-react';\nimport { Socket } from 'socket.io';\nimport 'emoji-mart/css/emoji-mart.css';\nimport { EmojiData, Picker } from 'emoji-mart';\nimport onClickOutside from 'react-onclickoutside';\n\nimport { formatTimestamp, getColorHex, getDefaultPicture } from '../../utils';\nimport { Separator } from '../App/App';\n\ninterface ChatProps {\n  chat: ChatMessage[];\n  nameMap: StringDict;\n  pictureMap: StringDict;\n  socket: Socket;\n  scrollTimestamp: number;\n  className?: string;\n  getMediaDisplayName: Function;\n  hide?: boolean;\n}\n\nexport class Chat extends React.Component<ChatProps> {\n  public state = { chatMsg: '', isNearBottom: true, isPickerOpen: false };\n  messagesRef = React.createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    this.scrollToBottom();\n    this.messagesRef.current?.addEventListener('scroll', this.onScroll);\n  }\n\n  componentDidUpdate(prevProps: ChatProps) {\n    if (this.props.scrollTimestamp !== prevProps.scrollTimestamp) {\n      if (prevProps.scrollTimestamp === 0 || this.state.isNearBottom) {\n        this.scrollToBottom();\n      }\n    }\n    if (this.props.hide !== prevProps.hide) {\n      this.scrollToBottom();\n    }\n  }\n\n  updateChatMsg = (e: any, data: { value: string }) => {\n    // console.log(e.target.selectionStart);\n    this.setState({ chatMsg: data.value });\n  };\n\n  sendChatMsg = () => {\n    if (!this.state.chatMsg) {\n      return;\n    }\n    if (this.chatTooLong()) {\n      return;\n    }\n    this.setState({ chatMsg: '' });\n    this.props.socket.emit('CMD:chat', this.state.chatMsg);\n  };\n\n  chatTooLong = () => {\n    return Boolean(this.state.chatMsg?.length > 10000);\n  };\n\n  onScroll = () => {\n    this.setState({ isNearBottom: this.isChatNearBottom() });\n  };\n\n  isChatNearBottom = () => {\n    return (\n      this.messagesRef.current &&\n      this.messagesRef.current.scrollHeight -\n        this.messagesRef.current.scrollTop -\n        this.messagesRef.current.offsetHeight <\n        100\n    );\n  };\n\n  scrollToBottom = () => {\n    if (this.messagesRef.current) {\n      this.messagesRef.current.scrollTop = this.messagesRef.current.scrollHeight;\n    }\n  };\n\n  formatMessage = (cmd: string, msg: string): React.ReactNode | string => {\n    if (cmd === 'host') {\n      return (\n        <React.Fragment>\n          {`changed the video to `}\n          <span style={{ textTransform: 'initial' }}>\n            {this.props.getMediaDisplayName(msg)}\n          </span>\n        </React.Fragment>\n      );\n    } else if (cmd === 'seek') {\n      return `jumped to ${formatTimestamp(msg)}`;\n    } else if (cmd === 'play') {\n      return `started the video at ${formatTimestamp(msg)}`;\n    } else if (cmd === 'pause') {\n      return `paused the video at ${formatTimestamp(msg)}`;\n    } else if (cmd === 'lock') {\n      return `locked the room`;\n    } else if (cmd === 'unlock') {\n      return 'unlocked the room';\n    } else if (cmd === 'vBrowserTimeout') {\n      return (\n        <React.Fragment>\n          The VBrowser shut down automatically.\n          <br />\n          Subscribe for sessions up to 12 hours.\n        </React.Fragment>\n      );\n    } else if (cmd === 'vBrowserAlmostTimeout') {\n      return (\n        <React.Fragment>\n          The VBrowser will shut down soon.\n          <br />\n          Subscribe for sessions up to 12 hours.\n        </React.Fragment>\n      );\n    }\n    return cmd;\n  };\n\n  addEmoji = (emoji: EmojiData) => {\n    this.setState({ chatMsg: this.state.chatMsg + (emoji as any).native });\n  };\n\n  render() {\n    return (\n      <div\n        className={this.props.className}\n        style={{\n          display: this.props.hide ? 'none' : 'flex',\n          flexDirection: 'column',\n          flexGrow: 1,\n          minHeight: 0,\n          marginTop: 0,\n          marginBottom: 0,\n          padding: '8px',\n        }}\n      >\n        <div\n          className=\"chatContainer\"\n          ref={this.messagesRef}\n          style={{ position: 'relative' }}\n        >\n          <Comment.Group>\n            {this.props.chat.map((msg) => (\n              <ChatMessage\n                key={msg.timestamp + msg.id}\n                message={msg}\n                pictureMap={this.props.pictureMap}\n                nameMap={this.props.nameMap}\n                formatMessage={this.formatMessage}\n              />\n            ))}\n            {/* <div ref={this.messagesEndRef} /> */}\n          </Comment.Group>\n          {!this.state.isNearBottom && (\n            <Button\n              size=\"tiny\"\n              onClick={this.scrollToBottom}\n              style={{\n                position: 'sticky',\n                bottom: 0,\n                display: 'block',\n                margin: '0 auto',\n              }}\n            >\n              Jump to bottom\n            </Button>\n          )}\n        </div>\n        <Separator />\n        {this.state.isPickerOpen && (\n          <PickerMenu\n            addEmoji={this.addEmoji}\n            closeMenu={() => this.setState({ isPickerOpen: false })}\n          />\n        )}\n        <Input\n          inverted\n          fluid\n          onKeyPress={(e: any) => e.key === 'Enter' && this.sendChatMsg()}\n          onChange={this.updateChatMsg}\n          value={this.state.chatMsg}\n          error={this.chatTooLong()}\n          icon\n          placeholder=\"Enter a message...\"\n        >\n          <input />\n          <Icon\n            // style={{ right: '40px' }}\n            onClick={() => this.setState({ isPickerOpen: true })}\n            name={'' as any}\n            inverted\n            circular\n            link\n            style={{ opacity: 1 }}\n          >\n            <span role=\"img\" aria-label=\"Emoji\">\n              😀\n            </span>\n          </Icon>\n          {/* <Icon onClick={this.sendChatMsg} name=\"send\" inverted circular link /> */}\n        </Input>\n      </div>\n    );\n  }\n}\n\nconst ChatMessage = ({\n  message,\n  nameMap,\n  pictureMap,\n  formatMessage,\n}: {\n  message: ChatMessage;\n  nameMap: StringDict;\n  pictureMap: StringDict;\n  formatMessage: (cmd: string, msg: string) => React.ReactNode;\n}) => {\n  const { id, timestamp, cmd, msg, system } = message;\n  return (\n    <Comment>\n      {id ? (\n        <Comment.Avatar\n          src={\n            pictureMap[id] || getDefaultPicture(nameMap[id], getColorHex(id))\n          }\n        />\n      ) : null}\n      <Comment.Content>\n        <Comment.Author as=\"a\" className=\"light\">\n          {Boolean(system) && 'System'}\n          {nameMap[id] || id}\n        </Comment.Author>\n        <Comment.Metadata className=\"dark\">\n          <div>{new Date(timestamp).toLocaleTimeString()}</div>\n        </Comment.Metadata>\n        <Comment.Text className=\"light system\">\n          {cmd && formatMessage(cmd, msg)}\n        </Comment.Text>\n        <Comment.Text className=\"light\">{!cmd && msg}</Comment.Text>\n      </Comment.Content>\n    </Comment>\n  );\n};\n\nclass PickerMenuInner extends React.Component<{\n  addEmoji: (emoji: EmojiData) => void;\n  closeMenu: Function;\n}> {\n  handleClickOutside = () => {\n    this.props.closeMenu();\n  };\n  render() {\n    return (\n      <div style={{ position: 'absolute', bottom: '60px' }}>\n        <Picker\n          set=\"google\"\n          sheetSize={64}\n          theme=\"dark\"\n          showPreview={false}\n          showSkinTones={false}\n          onSelect={this.props.addEmoji}\n        />\n      </div>\n    );\n  }\n}\n\nconst PickerMenu = onClickOutside(PickerMenuInner);\n"]},"metadata":{},"sourceType":"module"}